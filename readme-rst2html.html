<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.12: http://docutils.sourceforge.net/" />
<title>revue: getting Tumbleweed on it</title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 7614 2013-02-21 15:55:51Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

object[type="image/svg+xml"], object[type="application/x-shockwave-flash"] {
  overflow: hidden;
}

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title, .code .error {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: inherit }

/* div.align-center * { */
/*   text-align: left } */

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block, pre.math, pre.code {
  margin-left: 2em ;
  margin-right: 2em }

pre.code .ln { color: grey; } /* line numbers */
pre.code, code { background-color: #eeeeee }
pre.code .comment, code .comment { color: #5C6576 }
pre.code .keyword, code .keyword { color: #3B0D06; font-weight: bold }
pre.code .literal.string, code .literal.string { color: #0C5404 }
pre.code .name.builtin, code .name.builtin { color: #352B84 }
pre.code .deleted, code .deleted { background-color: #DEB0A1}
pre.code .inserted, code .inserted { background-color: #A3D289}

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

/* "booktabs" style (no vertical lines) */
table.docutils.booktabs {
  border: 0px;
  border-top: 2px solid;
  border-bottom: 2px solid;
  border-collapse: collapse;
}
table.docutils.booktabs * {
  border: 0px;
}
table.docutils.booktabs th {
  border-bottom: thin solid;
  text-align: left;
}

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document" id="revue-getting-tumbleweed-on-it">
<h1 class="title">revue: getting Tumbleweed on it</h1>

<p>This is a series of notes and articles about getting OpenSuSE <a class="footnote-reference" href="#opensuse-footnote" id="id1">[1]</a> Tumbleweed <a class="footnote-reference" href="#tumbleweed-footnote" id="id2">[2]</a> to run on a headless <a class="footnote-reference" href="#headless-footnote" id="id3">[4]</a> (i.e. text-only, no GUI) server.</p>
<p>The first machine I installed OpenSuSE Tumbleweed on is <tt class="docutils literal">revue</tt> <a class="footnote-reference" href="#revue-footnote" id="id4">[3]</a>. It is a bit of a gimmic, as I already had machines called <tt class="docutils literal">snip</tt> and <tt class="docutils literal">snap</tt>. Dutch people will know why.</p>
<p><tt class="docutils literal">snip</tt> and <tt class="docutils literal">snap</tt> run regular OpenSuSE releases. <tt class="docutils literal">revue</tt> is my first machine running a <a class="reference external" href="https://en.wikipedia.org/wiki/Rolling_release">rolling</a> release.</p>
<p>Over time, there will be some documents indicating installation progress and problem solving.</p>
<div class="section" id="table-of-contents">
<h1><a class="toc-backref" href="#id16">Table of Contents</a></h1>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#table-of-contents" id="id16">Table of Contents</a></li>
<li><a class="reference internal" href="#todo" id="id17">TODO</a></li>
<li><a class="reference internal" href="#notes" id="id18">NOTES</a><ul>
<li><a class="reference internal" href="#syslogd" id="id19">syslogd</a></li>
<li><a class="reference internal" href="#rest" id="id20">Rest</a></li>
</ul>
</li>
<li><a class="reference internal" href="#headless-install" id="id21">headless install</a><ul>
<li><a class="reference internal" href="#text-mode-console-will-break-line-drawing-after-first-boot" id="id22">text-mode console will break line drawing after first boot</a></li>
<li><a class="reference internal" href="#start-with-minimal-server-selection-text-mode" id="id23">Start with &quot;Minimal server selection (text mode)&quot;</a></li>
<li><a class="reference internal" href="#halt-will-fail-use-halt-p-to-halt-under-esxi-5-1" id="id24"><tt class="docutils literal">halt</tt> will fail, use <tt class="docutils literal">halt <span class="pre">-p</span></tt> to halt under ESXi 5.1</a></li>
<li><a class="reference internal" href="#id8" id="id25">text-mode installation and conflicts</a></li>
<li><a class="reference internal" href="#add-git-extras" id="id26">add git-extras</a></li>
</ul>
</li>
<li><a class="reference internal" href="#configuration" id="id27">configuration</a><ul>
<li><a class="reference internal" href="#getting-started-with-etckeeper" id="id28">getting started with etckeeper</a></li>
<li><a class="reference internal" href="#removing-hardlinks-from-the-etckeeper-repository" id="id29">removing hardlinks from the <tt class="docutils literal">etckeeper</tt> repository</a></li>
<li><a class="reference internal" href="#adding-user-jeroenp-to-sudoers-so-it-can-perform-sudo" id="id30">Adding user <tt class="docutils literal">jeroenp</tt> to <tt class="docutils literal">SUDOERS</tt> so it can perform <tt class="docutils literal">sudo</tt></a></li>
<li><a class="reference internal" href="#configuring-ssh" id="id31">configuring ssh</a></li>
<li><a class="reference internal" href="#install-and-configure-noip-dynamic-dns-update-script" id="id32">install and configure <cite>noip</cite> dynamic DNS update script</a></li>
<li><a class="reference internal" href="#configuring-ntpd-firewall-and-jail-for-it" id="id33">configuring ntpd, firewall and jail for it</a></li>
<li><a class="reference internal" href="#configuring-samba" id="id34">Configuring <tt class="docutils literal">samba</tt></a></li>
<li><a class="reference internal" href="#testing-and-fixing-so-clients-can-talk-to-our-samba-server" id="id35">Testing and fixing so clients can talk to our Samba server</a></li>
<li><a class="reference internal" href="#one-day-syncing-between-the-samba-password-and-system-password-storage-is-setup" id="id36">One day: syncing between the Samba password and system password storage is setup</a></li>
<li><a class="reference internal" href="#fixing-password-synchronisation" id="id37">Fixing password synchronisation?</a></li>
<li><a class="reference internal" href="#configuring-named-bind" id="id38">configuring named/BIND</a></li>
<li><a class="reference internal" href="#ensure-that-var-lib-named-master-gets-synced-to-etc-named-master" id="id39">Ensure that <tt class="docutils literal">/var/lib/named/master</tt> gets synced to <tt class="docutils literal">/etc/named/master</tt></a></li>
<li><a class="reference internal" href="#adding-aliases-for-commands-removed-in-net-tools" id="id40">Adding aliases for commands removed in <tt class="docutils literal"><span class="pre">net-tools</span></tt></a></li>
<li><a class="reference internal" href="#configuring-monit-monitoring-service" id="id41">Configuring <tt class="docutils literal">monit</tt> monitoring service</a></li>
<li><a class="reference internal" href="#configuring-apache2-for-the-first-time" id="id42">Configuring apache2 for the first time</a></li>
<li><a class="reference internal" href="#getting-and-running-testssl-sh" id="id43">Getting and running <tt class="docutils literal">testssl.sh</tt></a></li>
<li><a class="reference internal" href="#login-reboot-fritz-box" id="id44">Login / Reboot Fritz!Box</a></li>
<li><a class="reference internal" href="#configuring-and-running-shellinabox-with-ssh" id="id45">configuring and running shellinabox with ssh</a></li>
<li><a class="reference internal" href="#viewing-the-long-journal" id="id46">Viewing the long journal</a></li>
<li><a class="reference internal" href="#hardening-apache2-ssl-cyphers" id="id47">Hardening apache2 SSL cyphers</a></li>
<li><a class="reference internal" href="#enabling-https-for-apache2" id="id48">Enabling https for apache2</a><ul>
<li><a class="reference internal" href="#generating-the-private-key-protected-with-a-strong-password" id="id49">Generating the private key protected with a strong password</a></li>
<li><a class="reference internal" href="#generate-the-csr-certificate-signing-request" id="id50">Generate the CSR (Certificate Signing Request)</a></li>
<li><a class="reference internal" href="#id15" id="id51">Notes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#zypper-updating" id="id52">Zypper updating</a></li>
<li><a class="reference internal" href="#mariadb-dependency" id="id53">mariadb dependency</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="todo">
<h1><a class="toc-backref" href="#id17">TODO</a></h1>
<ul class="simple">
<li>harden OpenSSL.</li>
<li>web site (HTTP-HTTPS)</li>
<li>pop3 (port 110)</li>
<li>email (SMTP-SSMTP) 25/587</li>
<li>rsync (backups) port 873</li>
<li>modem reboot script (when either ipv4 or ipv6 are down)</li>
<li>certificates for web and shellinabox</li>
<li>update root zones through cron</li>
<li>DNS security &lt;<a class="reference external" href="https://www.digitalocean.com/community/tutorials/how-to-setup-dnssec-on-an-authoritative-bind-dns-server--2">https://www.digitalocean.com/community/tutorials/how-to-setup-dnssec-on-an-authoritative-bind-dns-server--2</a>&gt; and &lt;<a class="reference external" href="http://csrc.nist.gov/groups/SMA/fasp/documents/network_security/NISTSecuringDNS/NISTSecuringDNS.htm">http://csrc.nist.gov/groups/SMA/fasp/documents/network_security/NISTSecuringDNS/NISTSecuringDNS.htm</a>&gt;</li>
<li>ensure 10rsync-var-lib-named-master.sh works</li>
<li>fix syslogd and logrotate</li>
<li>via <a class="reference external" href="https://raymii.org/s/tutorials/Strong_SSL_Security_On_Apache2.html">Secure your Apache Server</a>:<ul>
<li><a class="reference external" href="https://en.wikipedia.org/wiki/HTTP_Strict_Transport_Security">HTTP Strict Transport Security</a></li>
<li><a class="reference external" href="https://wiki.mozilla.org/SecurityEngineering/Public_Key_Pinning">SecurityEngineering/Public Key Pinning</a></li>
<li><a class="reference external" href="https://raymii.org/s/tutorials/OCSP_Stapling_on_Apache2.html">OCSP Stapling on Apache</a></li>
<li><a class="reference external" href="https://testssl.sh/">testssl.sh</a></li>
<li><a class="reference external" href="https://www.ssllabs.com/ssltest/">SSLLabs SSL Server Test</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="notes">
<h1><a class="toc-backref" href="#id18">NOTES</a></h1>
<p>Things that might need doing.</p>
<div class="section" id="syslogd">
<h2><a class="toc-backref" href="#id19">syslogd</a></h2>
<p>See <a class="reference external" href="http://www.linuxquestions.org/questions/linux-general-1/how-to-completely-remove-service-from-systemd-using-systemctl-opensuse-4175531795/">this output</a>:</p>
<pre class="literal-block">
revue:/etc/xinetd.d # systemctl --failed --all
  UNIT              LOAD   ACTIVE SUB    DESCRIPTION
● logrotate.service loaded failed failed Rotate log files
● syslogd.service   loaded failed failed System Logging Service

LOAD   = Reflects whether the unit definition was properly loaded.
ACTIVE = The high-level unit activation state, i.e. generalization of SUB.
SUB    = The low-level unit activation state, values depend on unit type.

2 loaded units listed.
To show all installed unit files use 'systemctl list-unit-files'.
</pre>
<p>Needs investigation.</p>
</div>
<div class="section" id="rest">
<h2><a class="toc-backref" href="#id20">Rest</a></h2>
<p>Wget/curl are the best solution to update the <tt class="docutils literal">root.hint</tt>. See:</p>
<ul class="simple">
<li>&lt;<a class="reference external" href="http://lists.opensuse.org/opensuse/2008-05/msg01589.html">http://lists.opensuse.org/opensuse/2008-05/msg01589.html</a>&gt; - use dig, maybe not good</li>
<li>&lt;<a class="reference external" href="http://lists.opensuse.org/opensuse/2008-05/msg01746.html">http://lists.opensuse.org/opensuse/2008-05/msg01746.html</a>&gt;</li>
<li>&lt;<a class="reference external" href="http://lists.opensuse.org/opensuse/2008-05/msg01755.html">http://lists.opensuse.org/opensuse/2008-05/msg01755.html</a>&gt; - how to post it so Security picks it up</li>
<li>&lt;<a class="reference external" href="http://lists.opensuse.org/opensuse/2008-05/msg01658.html">http://lists.opensuse.org/opensuse/2008-05/msg01658.html</a>&gt; - use ftp</li>
</ul>
<p>The change in root servers resulted in a <a class="reference external" href="https://bugzilla.novell.com/show_bug.cgi?id=392173">security bug fix</a>, but that took a while.</p>
<p><a class="reference external" href="http://www.tldp.org/HOWTO/DNS-HOWTO-8.html">This script</a> gets it through dig too, but not the best solution.</p>
<p>Neither ftp, nor http are really secure to get these files from &lt;<a class="reference external" href="http://ftp.internic.net/domain/">http://ftp.internic.net/domain/</a>&gt;:</p>
<ul class="simple">
<li>&lt;<a class="reference external" href="ftp://ftp.internic.net/domain/db.cache">ftp://ftp.internic.net/domain/db.cache</a>&gt;</li>
<li>&lt;<a class="reference external" href="ftp://ftp.internic.net/domain/named.cache">ftp://ftp.internic.net/domain/named.cache</a>&gt;</li>
<li>&lt;<a class="reference external" href="ftp://ftp.internic.net/domain/named.root">ftp://ftp.internic.net/domain/named.root</a>&gt;</li>
<li>&lt;<a class="reference external" href="http://www.internic.net/domain/db.cache">http://www.internic.net/domain/db.cache</a>&gt;</li>
<li>&lt;<a class="reference external" href="http://www.internic.net/domain/named.cache">http://www.internic.net/domain/named.cache</a>&gt;</li>
<li>&lt;<a class="reference external" href="http://www.internic.net/domain/named.root">http://www.internic.net/domain/named.root</a>&gt;</li>
</ul>
<p>An alternative might be to get the <tt class="docutils literal">.sig</tt> there in in a secure way, then <a class="reference external" href="http://www.linuxquestions.org/questions/linux-newbie-8/md5-and-sig-537564/">use gpg to verify the signatures</a> (as <a class="reference external" href="http://stackoverflow.com/questions/15194779/md5-vs-gpg-signature/15195785#15195785">gpg seems more secure than md5 signatures</a>).</p>
<p>This is more difficult than it looks like, as you need their GPG public key with ID <tt class="docutils literal">0BD07395</tt>.</p>
<p>Some notes:</p>
<blockquote>
<p>## <a class="reference external" href="http://codenimbus.com/2010/08/02/override-robots-txt-with-wget/">http://codenimbus.com/2010/08/02/override-robots-txt-with-wget/</a>
wget -e robots=off --wait 1 <a class="reference external" href="http://your.site.here">http://your.site.here</a></p>
<p>## <a class="reference external" href="http://data.iana.org/root-anchors/draft-icann-dnssec-trust-anchor.html">http://data.iana.org/root-anchors/draft-icann-dnssec-trust-anchor.html</a>
wget -e robots=off -m -np <a class="reference external" href="http://data.iana.org/root-anchors">http://data.iana.org/root-anchors</a></p>
<p>wget -m -np <a class="reference external" href="http://www.internic.net/zones">http://www.internic.net/zones</a></p>
<p>## <a class="reference external" href="http://www.pgpi.org/doc/pgpintro/#p12">http://www.pgpi.org/doc/pgpintro/#p12</a>
gpg --verify named.root.sig named.root</p>
<p>## <a class="reference external" href="http://www.links.org/?p=542">http://www.links.org/?p=542</a>
## <a class="reference external" href="https://www.google.com/search?q=key+0BD07395">https://www.google.com/search?q=key+0BD07395</a>
## <a class="reference external" href="http://xenotrope.blogspot.nl/2015/04/on-dnssec-part-2-i-actually-used-dnssec.html">http://xenotrope.blogspot.nl/2015/04/on-dnssec-part-2-i-actually-used-dnssec.html</a></p>
<p>## <a class="reference external" href="http://ivan.kanis.fr/verifying-a-gpg-signed-file.html">http://ivan.kanis.fr/verifying-a-gpg-signed-file.html</a>
## <a class="reference external" href="https://www.gnupg.org/documentation/manuals/gnupg/GPG-Configuration-Options.html">https://www.gnupg.org/documentation/manuals/gnupg/GPG-Configuration-Options.html</a></p>
<p>## <a class="reference external" href="https://www.gnupg.org/gph/en/manual/x457.html">https://www.gnupg.org/gph/en/manual/x457.html</a>
## <a class="reference external" href="http://superuser.com/questions/227991/where-to-upload-pgp-public-key-are-keyservers-still-surviving">http://superuser.com/questions/227991/where-to-upload-pgp-public-key-are-keyservers-still-surviving</a>
gpg --keyserver keys.gnupg.net --recv-key 0BD07395
gpg --verify named.root.sig named.root</p>
<p>## <a class="reference external" href="http://security.stackexchange.com/questions/6841/ways-to-sign-gpg-public-key-so-it-is-trusted">http://security.stackexchange.com/questions/6841/ways-to-sign-gpg-public-key-so-it-is-trusted</a>
## <a class="reference external" href="http://stackoverflow.com/questions/26217766/download-key-with-gpg-recv-key-and-simultaneously-check-fingerprint-in-a-scr">http://stackoverflow.com/questions/26217766/download-key-with-gpg-recv-key-and-simultaneously-check-fingerprint-in-a-scr</a></p>
</blockquote>
<p>Some more:</p>
<pre class="literal-block">
snap:/tmp/www.internic.net/zones # gpg --verify named.root.sig named.root
gpg: Signature made Sat May 23 14:50:54 2015 CEST using DSA key ID 0BD07395
gpg: Can't check signature: No public key

gpg --keyserver keys.gnupg.net --recv-key 0BD07395

gpg --verify named.root.sig named.root
gpg: Signature made Sat May 23 14:50:54 2015 CEST using DSA key ID 0BD07395
gpg: Good signature from &quot;Registry Administrator &lt;nstld&#64;verisign-grs.com&gt;&quot;
gpg: WARNING: This key is not certified with a trusted signature!
gpg:          There is no indication that the signature belongs to the owner.
Primary key fingerprint: 81F6 6E4A 1CE4 4531 08DB  6811 84FA 869E 0BD0 7395
</pre>
<p>I had this in <tt class="docutils literal">named_root_hint.cron</tt>:</p>
<pre class="literal-block">
#! /bin/sh
#

RootHint=root.hint
NamedCache=named.cache
NamedCacheDownloadPath=ftp.internic.net/domain/$NamedCache
FtpNamedCacheDownloadPath=ftp://$NamedCacheDownloadPath
VarLibNamed=/var/lib/named/
VarLibNamedNamedCache=$VarLibNamed$NamedCache
VarLibNamedRootHint=$VarLibNamed$RootHint
VarLibNamedNamedCacheNew=$VarLibNamed$NamedCache.new

#echo &quot;$RootHint&quot;
#echo &quot;$NamedCacheDownloadPath&quot;
#echo &quot;ftp://ftp.internic.net/domain&quot;
#echo &quot;$FtpNamedCacheDownloadPath&quot;
#echo &quot;$VarLibNamedNamedCache&quot;
#echo &quot;$VarLibNamedNamedCacheNew&quot;

cd $VarLibNamed
wget -q -N $FtpNamedCacheDownloadPath

if (test -e $VarLibNamedNamedCache) ; then

  diff $VarLibNamedNamedCache $VarLibNamedNamedCacheNew

  if [ &quot;$?&quot; -ne &quot;0&quot; ] ; then
  # if $VarLibNamedNamedCacheNew does not exist, or $VarLibNamedNamedCache is different from $VarLibNamedNamedCacheNew

    cp -f $VarLibNamedNamedCache $VarLibNamedNamedCacheNew
    echo &quot;There is a fresh $VarLibNamedNamedCacheNew file that you might want to update into $VarLibNamedRootHint&quot;
  fi

  diff $VarLibNamedRootHint $VarLibNamedNamedCacheNew

  if [ &quot;$?&quot; -ne &quot;0&quot; ] ; then
  # if $VarLibNamedNamedCacheNew does not exist, or $VarLibNamedRootHint is different from $VarLibNamedNamedCacheNew

#    rcnamed restart
    echo &quot;$VarLibNamedRootHint is different from $VarLibNamedNamedCacheNew, you might need to update $VarLibNamedRootHint, then perform rcnamed restart &quot;
  fi

  rm -f $VarLibNamedNamedCache
fi
</pre>
</div>
</div>
<div class="section" id="headless-install">
<h1><a class="toc-backref" href="#id21">headless install</a></h1>
<div class="section" id="text-mode-console-will-break-line-drawing-after-first-boot">
<h2><a class="toc-backref" href="#id22">text-mode console will break line drawing after first boot</a></h2>
<p>A long standing bug, and I'm amazed not more people complain about this.</p>
<p>I've queued a <a class="reference external" href="https://wiert.wordpress.com/?p=27755&quot;">blog entry</a> about this titled &quot;TUMBLEWEED: local console yast linedrawing characters garbage after first reboot&quot;.</p>
<p>The workaround is simple: Call <tt class="docutils literal">/bin/unicode_start</tt> on the command line
before starting <tt class="docutils literal">yast</tt>. It looks you need this only once per machine.</p>
</div>
<div class="section" id="start-with-minimal-server-selection-text-mode">
<h2><a class="toc-backref" href="#id23">Start with &quot;Minimal server selection (text mode)&quot;</a></h2>
<p>The OpenSuSE way of a headless install starts with &quot;Minimal server selection (text mode)&quot;. On top of that you extend the installation.</p>
<p>In about 20 gigabyte disk space, you can &quot;Minimal server selection (text mode)&quot; extended by a limited set of packages.</p>
<p>These are the <strong>patterns</strong> I extended with:</p>
<ul class="simple">
<li><a class="reference external" href="https://software.opensuse.org/package/patterns-openSUSE-enhanced_base">Enhanced Base System</a></li>
<li><a class="reference external" href="https://www.google.com/search?q=&quot;Console+Tools&quot;+site%3Aopensuse.org">Console Tools</a></li>
<li><a class="reference external" href="https://www.google.com/search?q=&quot;File+Server&quot;+site%3Aopensuse.org">File Server</a></li>
<li><a class="reference external" href="https://www.google.com/search?q=&quot;Network+Administration&quot;+site%3Aopensuse.org">Network Administration</a></li>
<li><a class="reference external" href="https://www.google.com/search?q=&quot;Mail+and+News+Server&quot;+site%3Aopensuse.org">Mail and News Server</a></li>
<li><a class="reference external" href="https://www.google.com/search?q=&quot;Web+and+LAMP+Server&quot;+site%3Aopensuse.org">Web and LAMP Server</a></li>
<li><a class="reference external" href="hhttps://www.google.com/search?q=&quot;Internet+Gateway&quot;+site%3Aopensuse.org">Internet Gateway</a></li>
<li><a class="reference external" href="https://www.google.com/search?q=&quot;DHCP+and+DNS+Server&quot;+site%3Aopensuse.org">DHCP and DNS Server</a></li>
</ul>
<p>As <strong>LAMP</strong> installs mariadb, and as of somewhere around July 2015 mariadb bugs about it being installed with default non-password database root credentials:</p>
<pre class="literal-block">
revue:/etc # zypper rm mariadb
Loading repository data...
Reading installed packages...
Resolving package dependencies...

The following package is going to be REMOVED:
  mariadb

1 package to remove.
After the operation, 78.7 MiB will be freed.
Continue? [y/n/? shows all options] (y): y
(1/1) Removing mariadb-10.0.17-1.3 .....................................................................................................................................................................................................[done]

revue:/etc # zypper search &quot;LAMP&quot;
Loading repository data...
Reading installed packages...

S | Name                          | Summary             | Type
--+-------------------------------+---------------------+--------
i | lamp_server                   | Web and LAMP Server | pattern
i | patterns-openSUSE-lamp_server | Web and LAMP Server | package

revue:/etc # zypper remove patterns-openSUSE-lamp_server
Loading repository data...
Reading installed packages...
Resolving package dependencies...

The following package is going to be REMOVED:
  patterns-openSUSE-lamp_server

The following pattern is going to be REMOVED:
  lamp_server

1 package to remove.
After the operation, 57.0 B will be freed.
Continue? [y/n/? shows all options] (y): y
(1/1) Removing patterns-openSUSE-lamp_server-20150603-4.1 ..............................................................................................................................................................................[done]
revue:/etc #

revue:/etc # zypper remove mariadb-client mariadb-errormessages
Loading repository data...
Reading installed packages...
Resolving package dependencies...

The following 2 packages are going to be REMOVED:
  mariadb-client mariadb-errormessages

2 packages to remove.
After the operation, 21.8 MiB will be freed.
Continue? [y/n/? shows all options] (y): y
(1/2) Removing mariadb-client-10.0.17-1.3 ..............................................................................................................................................................................................[done]
(2/2) Removing mariadb-errormessages-10.0.17-1.3 .......................................................................................................................................................................................[done]
revue:/etc #
</pre>
<p>If I ever need MySQL or MariaDB, I will get it again and solve the root rights.</p>
<p>Finally time for some manual adding of <strong>packages</strong>:</p>
<div class="note">
<p class="first admonition-title">Note</p>
<p class="last">Note that some of these won't install just yet, see the <a class="reference external" href="text-mode-installation-and-conflicts">text-mode installation and conflicts</a> section.</p>
</div>
<ul class="simple">
<li><a class="reference external" href="https://software.opensuse.org/package/etckeeper">etckeeper</a></li>
<li><a class="reference external" href="https://software.opensuse.org/package/syslogd">syslogd</a></li>
<li><a class="reference external" href="https://software.opensuse.org/package/emacs">emacs</a></li>
<li><a class="reference external" href="https://software.opensuse.org/package/joe">joe</a></li>
<li><a class="reference external" href="https://software.opensuse.org/package/nano">nano</a></li>
<li><a class="reference external" href="https://software.opensuse.org/package/pico">pico</a></li>
<li><a class="reference external" href="https://software.opensuse.org/package/vim">vim</a></li>
<li><a class="reference external" href="https://software.opensuse.org/package/dovecot">dovecot</a></li>
<li><a class="reference external" href="https://software.opensuse.org/package/mutt">mutt</a></li>
<li><a class="reference external" href="https://software.opensuse.org/package/par">par</a></li>
<li><a class="reference external" href="https://software.opensuse.org/package/make">make</a></li>
<li><a class="reference external" href="https://software.opensuse.org/package/monit">monit</a></li>
<li><a class="reference external" href="https://software.opensuse.org/package/mc">mc</a></li>
<li><a class="reference external" href="https://software.opensuse.org/package/mirror">mirror</a></li>
<li><a class="reference external" href="https://software.opensuse.org/package/p7zip">p7zip</a></li>
<li><a class="reference external" href="https://software.opensuse.org/package/zip">zip</a></li>
<li><a class="reference external" href="https://software.opensuse.org/package/zsync">zsync</a></li>
<li><a class="reference external" href="https://software.opensuse.org/package/git">git</a></li>
<li><a class="reference external" href="hhttps://software.opensuse.org/package/mercurial">mercurial</a>*</li>
<li><a class="reference external" href="hhttps://software.opensuse.org/package/perl">perl</a></li>
<li><a class="reference external" href="https://software.opensuse.org/package/php">php</a>*</li>
<li><a class="reference external" href="https://software.opensuse.org/package/apache2-mod_php5">apache2-mod_php5</a>*</li>
<li><a class="reference external" href="https://software.opensuse.org/package/python">python</a>*</li>
<li><a class="reference external" href="https://software.opensuse.org/package/dropbox">dropbox</a>*</li>
<li><a class="reference external" href="https://software.opensuse.org/package/ca-certificates-cacert">ca-certificates-cacert</a></li>
<li><a class="reference external" href="https://software.opensuse.org/package/bridge-utils">bridge-utils</a></li>
<li><a class="reference external" href="https://software.opensuse.org/package/fping">fping</a></li>
<li><a class="reference external" href="https://software.opensuse.org/package/ftp">ftp</a></li>
<li><a class="reference external" href="https://software.opensuse.org/package/gftp">gftp</a></li>
<li><a class="reference external" href="https://software.opensuse.org/package/icecast">icecast</a></li>
<li><a class="reference external" href="https://software.opensuse.org/package/links">links</a></li>
<li><a class="reference external" href="https://software.opensuse.org/package/iptraf-ng">iptraf-ng</a></li>
<li><a class="reference external" href="https://software.opensuse.org/package/shellinabox">shellinabox</a></li>
<li><a class="reference external" href="hhttps://software.opensuse.org/package/kvirustotal">kvirustotal</a></li>
<li><a class="reference external" href="https://software.opensuse.org/package/monit">monit</a></li>
</ul>
<p>These packages were already installed:</p>
<ul class="simple">
<li><a class="reference external" href="https://software.opensuse.org/package/info">info</a></li>
<li><a class="reference external" href="https://software.opensuse.org/package/man">man</a></li>
<li><a class="reference external" href="https://software.opensuse.org/package/man-pages">man-pages</a></li>
<li><a class="reference external" href="https://software.opensuse.org/package/mc">mc</a></li>
<li><a class="reference external" href="https://software.opensuse.org/package/w3m">w3m</a></li>
</ul>
<p>Didn't yet install:</p>
<ul class="simple">
<li><a class="reference external" href="https://software.opensuse.org/package/bash-doc">bash-doc</a>*</li>
<li><a class="reference external" href="https://software.opensuse.org/package/samba-doc">samba-doc</a>*</li>
</ul>
<div class="note">
<p class="first admonition-title">Note</p>
<p>If you want to know <a class="reference external" href="http://unix.stackexchange.com/questions/158041/how-do-i-find-a-package-that-provides-a-given-file-in-opensuse">which package provides a certain file</a>, then use this command:</p>
<pre class="literal-block">
zypper search --provides --match-exact hg
</pre>
<p class="last">Where <tt class="docutils literal">hg</tt> is the file you are looking for.</p>
</div>
</div>
<div class="section" id="halt-will-fail-use-halt-p-to-halt-under-esxi-5-1">
<h2><a class="toc-backref" href="#id24"><tt class="docutils literal">halt</tt> will fail, use <tt class="docutils literal">halt <span class="pre">-p</span></tt> to halt under ESXi 5.1</a></h2>
<p>A long time ago, <a class="reference external" href="http://wiert.me/2012/12/30/opensuse-12-x-a-plain-halt-will-not-shutdown-the-system-properly/">I wrote that</a> <tt class="docutils literal">halt</tt> fails, but <tt class="docutils literal">halt <span class="pre">-p</span></tt> succeeds when running under VMware ESXi 5.1 (I don't run physical boxes any more).</p>
<p>This still fails under OpenSuSE Tumbleweed 13.2.</p>
</div>
<div class="section" id="id8">
<h2><a class="toc-backref" href="#id25">text-mode installation and conflicts</a></h2>
<p>The easiest way to start a headless install is picking &quot;Minimal server selection (text mode)&quot; during installation.</p>
<p>The problem however is that this indeed minimal. It is enforced by the <tt class="docutils literal"><span class="pre">patterns-openSUSE-minimal_base-conflicts</span></tt> <a class="footnote-reference" href="#patterns-opensuse-minimal-base-conflicts-footnote" id="id9">[5]</a> pattern which is part of the minimal install.</p>
<p>It prevents some packages to install like <tt class="docutils literal">mercurial</tt>, <tt class="docutils literal">php</tt> and <tt class="docutils literal">python</tt>.</p>
<p>To prevent that, remove the <tt class="docutils literal"><span class="pre">patterns-openSUSE-minimal_base-conflicts</span></tt> package specific for the OpenSuSE version you use <a class="footnote-reference" href="#removeconflicts-footnote" id="id10">[6]</a>.</p>
<p>Do this <strong>after</strong> you've selected the patterns you want to install. Otherwise recommended packages can be installed potentially blowing your size.</p>
</div>
<div class="section" id="add-git-extras">
<h2><a class="toc-backref" href="#id26">add git-extras</a></h2>
<p>See the <a class="reference external" href="https://github.com/tj/git-extras/blob/master/Installation.md">git-extras Install documentation</a> for why/how.</p>
<p>Just run this command:</p>
<pre class="literal-block">
(cd /tmp &amp;&amp; git clone https://github.com/tj/git-extras.git &amp;&amp; cd git-extras &amp;&amp; git checkout $(git describe --tags $(git rev-list --tags --max-count=1)) &amp;&amp; sudo make install)
</pre>
</div>
</div>
<div class="section" id="configuration">
<h1><a class="toc-backref" href="#id27">configuration</a></h1>
<div class="section" id="getting-started-with-etckeeper">
<h2><a class="toc-backref" href="#id28">getting started with etckeeper</a></h2>
<p>A while ago <tt class="docutils literal">etckeeper</tt> (which is <a class="reference external" href="https://github.com/joeyh/etckeeper">open source on GitHub</a>) was <a class="reference external" href="http://joeyh.name/code/etckeeper/">requested</a> to be put into the factory repository, and now <a class="reference external" href="https://software.opensuse.org/package/etckeeper">is</a>.</p>
<p>This is how I got started:</p>
<ol class="arabic">
<li><p class="first">I created a new private repository on bitbucket called <a class="reference external" href="https://bitbucket.org/jeroenp/etckeeper.revue">https://bitbucket.org/jeroenp/etckeeper.revue</a></p>
</li>
<li><p class="first">I ran these commands locally:</p>
<pre class="literal-block">
etckeeper init
cd /etc
git status
git commit -m &quot;initial checkin&quot;
git gc # pack git repo to save a lot of space

cd /path/to/my/repo
git remote add origin https://jeroenp&#64;bitbucket.org/jeroenp/etckeeper.revue.git
git push -u origin --all # pushes up the repo and its refs for the first time
git push -u origin --tags # pushes up any tags
</pre>
</li>
</ol>
<div class="note">
<p class="first admonition-title">Note</p>
<p><a class="reference external" href="http://etckeeper.branchable.com/">etckeeper</a> is a collection of tools to let <tt class="docutils literal">/etc</tt> be stored in a git, mercurial, bazaar or darcs repository. This lets you use git to review or revert changes that were made to <tt class="docutils literal">/etc</tt>. Or even push the repository elsewhere for backups or cherry-picking configuration changes.</p>
<p>It hooks into package managers like apt to automatically commit changes made to <tt class="docutils literal">/etc</tt> during package upgrades. It tracks file metadata that git does not normally support, but that is important for /etc, such as the permissions of <tt class="docutils literal">/etc/shadow</tt>.</p>
<p>It's quite modular and configurable, while also being simple to use if you understand the basics of working with version control.</p>
<p>Three important <tt class="docutils literal">etckeeper</tt> gotchas with powerful scripts like <a class="reference external" href="https://github.com/joeyh/etckeeper/tree/master/pre-commit.d">pre-commit</a> <tt class="docutils literal"><span class="pre">/etc/etckeeper/pre-commit.d</span></tt>:</p>
<ol class="arabic simple">
<li>ensure you give them executable permissions like <a class="reference external" href="http://www.networkredux.com/answers/linux-in-general/users-and-permissions/how-do-i-use-the-chmod-command-in-linux">chmod 755</a>.</li>
<li>ensure they are valid <a class="reference external" href="https://en.wikipedia.org/wiki/Bourne_shell">sh</a> scripts.</li>
<li>do not give them the .sh extension:</li>
</ol>
<blockquote class="last">
<ul class="simple">
<li>fails: <tt class="docutils literal"><span class="pre">/etc/etckeeper/pre-commit.d/10rsync-var-lib-named-master</span></tt></li>
<li>works: <tt class="docutils literal"><span class="pre">/etc/etckeeper/pre-commit.d/10rsync-var-lib-named-master.sh</span></tt></li>
</ul>
</blockquote>
</div>
</div>
<div class="section" id="removing-hardlinks-from-the-etckeeper-repository">
<h2><a class="toc-backref" href="#id29">removing hardlinks from the <tt class="docutils literal">etckeeper</tt> repository</a></h2>
<p>Inspired by <a class="reference external" href="http://unix.stackexchange.com/questions/63627/excluding-files-in-etckeeper-with-gitignore-doesnt-work/63628#63628">this answer</a> to get rid of these messages during <a class="reference external" href="https://github.com/joeyh/etckeeper#what-etckeeper-does">etckeeper commit</a> to delete many <a class="reference external" href="http://lists.opensuse.org/opensuse-factory/2014-06/msg00115.html">hardlinked bootsplash files</a>:</p>
<pre class="literal-block">
etckeeper warning: hardlinked files could cause problems with git:
bootsplash/themes/openSUSE/bootloader/af.tr
...
bootsplash/themes/openSUSE/bootloader/pt.tr
bootsplash/themes/openSUSE/bootloader/pt_BR.tr
bootsplash/themes/openSUSE/bootloader/ro.tr
...
bootsplash/themes/openSUSE/bootloader/xh.tr
bootsplash/themes/openSUSE/bootloader/zh_CN.tr
bootsplash/themes/openSUSE/bootloader/zh_TW.tr
bootsplash/themes/openSUSE/bootloader/zu.tr
bootsplash/themes/openSUSE/cdrom/af.tr
...
bootsplash/themes/openSUSE/cdrom/pt.tr
bootsplash/themes/openSUSE/cdrom/pt_BR.tr
bootsplash/themes/openSUSE/cdrom/ro.tr
...
bootsplash/themes/openSUSE/cdrom/xh.tr
bootsplash/themes/openSUSE/cdrom/zh_CN.tr
bootsplash/themes/openSUSE/cdrom/zh_TW.tr
bootsplash/themes/openSUSE/cdrom/zu.tr
</pre>
<p>Add these two lines to <tt class="docutils literal"><span class="pre">/etc/.gitignore</span></tt></p>
<blockquote>
bootsplash/themes/openSUSE/bootloader/<em>.tr
bootsplash/themes/openSUSE/cdrom/</em>.tr</blockquote>
<p>Note the <tt class="docutils literal"><span class="pre">--cache</span></tt> part in the command to delete, as then the files will not be deleted locally, only in the repository:</p>
<pre class="literal-block">
git add .gitignore
git rm --cached bootsplash/themes/openSUSE/bootloader/*.tr
git rm --cached bootsplash/themes/openSUSE/cdrom/*.tr
git commit -m &quot;git rm --cached bootsplash/themes/openSUSE/bootloader/*.tr and bootsplash/themes/openSUSE/cdrom/*.tr&quot;
</pre>
</div>
<div class="section" id="adding-user-jeroenp-to-sudoers-so-it-can-perform-sudo">
<h2><a class="toc-backref" href="#id30">Adding user <tt class="docutils literal">jeroenp</tt> to <tt class="docutils literal">SUDOERS</tt> so it can perform <tt class="docutils literal">sudo</tt></a></h2>
<ol class="arabic simple">
<li>Start <tt class="docutils literal">yast</tt></li>
<li>Open <tt class="docutils literal">Security and Users</tt>, then <tt class="docutils literal">Sudo</tt></li>
<li>Click <tt class="docutils literal">Add</tt></li>
</ol>
<blockquote>
<ol class="arabic simple">
<li>Select a <tt class="docutils literal">User</tt> (in my case <tt class="docutils literal">jeroenp</tt>)</li>
<li>Select a <tt class="docutils literal">Host</tt> (in my case <tt class="docutils literal">ALL</tt>)</li>
<li>At <tt class="docutils literal">RunAs</tt> type <tt class="docutils literal">ALL</tt> (this will get translated to <tt class="docutils literal">(ALL)</tt>)</li>
<li>Ensure that <tt class="docutils literal">No Password</tt> has a checkmark</li>
<li>Click <tt class="docutils literal">Add</tt></li>
</ol>
<blockquote>
<ol class="arabic simple">
<li>Select a <tt class="docutils literal">Command</tt> (in my case <tt class="docutils literal">ALL</tt>)</li>
<li>Press <tt class="docutils literal">OK</tt></li>
</ol>
</blockquote>
<ol class="arabic simple" start="5">
<li>Press <tt class="docutils literal">OK</tt></li>
</ol>
</blockquote>
<ol class="arabic simple" start="4">
<li>Press <tt class="docutils literal">OK</tt></li>
<li>Quit <tt class="docutils literal">yast</tt></li>
</ol>
<p>This will generate <tt class="docutils literal">/etc/sudoers.YaST2.save</tt> add a line to <tt class="docutils literal">/etc/sudoers</tt>:</p>
<pre class="literal-block">
jeroenp     ALL = (ALL) NOPASSWD:ALL
</pre>
<div class="note">
<p class="first admonition-title">Note</p>
<p class="last">Note that <a class="reference external" href="http://superuser.com/questions/357467/what-do-the-alls-in-the-line-admin-all-all-all-in-ubuntus-etc-sudoers">each ALL entry has a different meaning</a>.</p>
</div>
</div>
<div class="section" id="configuring-ssh">
<h2><a class="toc-backref" href="#id31">configuring ssh</a></h2>
<p>Up until OpenSuSE 12.x, there was yast2-sshd. It is <a class="reference external" href="https://www.suse.com/documentation/opensuse114/book_security/data/sec_ssh_yast.html">still in the documentation</a>, but it <a class="reference external" href="http://lists.opensuse.org/opensuse/2013-11/msg00751.html">has been orphaned</a> so you need to configure it manually. It isn't hard: below is the diff of the <tt class="docutils literal">/etc/sshd_config</tt> file.</p>
<p>Note that when manually changing sshd configuration options, you can test (<tt class="docutils literal"><span class="pre">-t</span></tt>) or test-extended (<tt class="docutils literal"><span class="pre">-T</span></tt>) <a class="reference external" href="https://www.ixsystems.com/whats-new/how-secure-can-secure-shell-ssh-be-basic-configuration-of-openssh/">like this</a>:</p>
<pre class="literal-block">
sshd –t
sshd -T
</pre>
<p>Part of the hardening is executing this from <tt class="docutils literal">/etc/ssh</tt>:</p>
<pre class="literal-block">
wget https://github.com/comotion/gone/blob/github/modules/ssh
chmod 700 ssh
./ssh
rm ./ssh
</pre>
<p>I finally saved the changes using <tt class="docutils literal">etckeeper</tt>:</p>
<pre class="literal-block">
etckeeper commit -m &quot;sshd and hardening&quot;
git push
</pre>
<p>This is what the diff looks like:</p>
<pre class="literal-block">
--- a/ssh/sshd_config
+++ b/ssh/sshd_config
&#64;&#64; -10,7 +10,13 &#64;&#64;
 # possible, but leave them commented.  Uncommented options override the
 # default value.

-#Port 22
+Port 22
+Port 10022
+Port 20022
+Port 30022
+Port 40022
+Port 50022
+Port 60022
 #AddressFamily any
 #ListenAddress 0.0.0.0
 #ListenAddress ::
&#64;&#64; -35,15 +41,15 &#64;&#64;

 # Logging
 # obsoletes QuietMode and FascistLogging
-#SyslogFacility AUTH
-#LogLevel INFO
+SyslogFacility AUTH
+LogLevel INFO

 # Authentication:

 #LoginGraceTime 2m
-#PermitRootLogin yes
-#StrictModes yes
-#MaxAuthTries 6
+PermitRootLogin no
+StrictModes yes
+MaxAuthTries 1
 #MaxSessions 10

 #RSAAuthentication yes
&#64;&#64; -61,28 +67,28 &#64;&#64; AuthorizedKeysFile      .ssh/authorized_keys
 # For this to work you will also need host keys in /etc/ssh/ssh_known_hosts
 #RhostsRSAAuthentication no
 # similar for protocol version 2
-#HostbasedAuthentication no
+HostbasedAuthentication no
 # Change to yes if you don't trust ~/.ssh/known_hosts for
 # RhostsRSAAuthentication and HostbasedAuthentication
 #IgnoreUserKnownHosts no
 # Don't read the user's ~/.rhosts and ~/.shosts files
-#IgnoreRhosts yes
+IgnoreRhosts yes

 # To disable tunneled clear text passwords, change to no here!
 PasswordAuthentication no
-#PermitEmptyPasswords no
+PermitEmptyPasswords no

 # Change to no to disable s/key passwords
-#ChallengeResponseAuthentication yes
+ChallengeResponseAuthentication yes

 # Kerberos options
-#KerberosAuthentication no
+KerberosAuthentication no
 #KerberosOrLocalPasswd yes
 #KerberosTicketCleanup yes
 #KerberosGetAFSToken no

 # GSSAPI options
-#GSSAPIAuthentication no
+GSSAPIAuthentication no
 #GSSAPICleanupCredentials yes
 #GSSAPIStrictAcceptorCheck yes
 #GSSAPIKeyExchange no
&#64;&#64; -107,17 +113,17 &#64;&#64; UsePAM yes

 #AllowAgentForwarding yes
 #AllowTcpForwarding yes
-#GatewayPorts no
-X11Forwarding yes
+GatewayPorts no
+X11Forwarding no
 #X11DisplayOffset 10
 #X11UseLocalhost yes
 #PermitTTY yes
-#PrintMotd yes
-#PrintLastLog yes
-#TCPKeepAlive yes
+PrintMotd no
+PrintLastLog yes
+TCPKeepAlive yes
 #UseLogin no
 UsePrivilegeSeparation sandbox             # Default for new installations.
-#PermitUserEnvironment no
+PermitUserEnvironment no
 #Compression delayed
 #ClientAliveInterval 0
 #ClientAliveCountMax 3
&#64;&#64; -129,7 +135,7 &#64;&#64; UsePrivilegeSeparation sandbox          # Default for new installations.
 #VersionAddendum none

 # no default banner path
-#Banner none
+Banner /etc/issue

 # override default of no subsystems
 Subsystem  sftp    /usr/lib/ssh/sftp-server
&#64;&#64; -145,3 +151,6 &#64;&#64; AcceptEnv LC_IDENTIFICATION LC_ALL
 #  AllowTcpForwarding no
 #  PermitTTY no
 #  ForceCommand cvs server
+KexAlgorithms curve25519-sha256&#64;libssh.org,diffie-hellman-group-exchange-sha256
+Ciphers chacha20-poly1305&#64;openssh.com,aes256-ctr,aes192-ctr,aes128-ctr
+MACs hmac-sha2-512-etm&#64;openssh.com,hmac-sha2-256-etm&#64;openssh.com,hmac-ripemd160-etm&#64;openssh.com,umac-128-etm&#64;openssh.com,hmac-sha2-512,hmac-sha2-256,hmac-ripemd160,umac-128&#64;openssh.com
</pre>
<div class="note">
<p class="first admonition-title">Note</p>
<p class="last">In the diff are steps from <a class="reference external" href="http://people.redhat.com/swells/mea/SECSCAN-FirstRun/sshd_config.htm">SSH Server Configuration rhel-lockdown</a>, <a class="reference external" href="http://wp.kjro.se/2013/09/06/hardening-your-ssh-server-opensshd_config/">Hardening your SSH server (opensshd_config)</a> and the script behind  <a class="reference external" href="http://kacper.blog.redpill-linpro.com/archives/702">http://kacper.blog.redpill-linpro.com/archives/702</a> from <a class="reference external" href="https://github.com/comotion/gone/blob/github/modules/ssh">gone/ssh at github · comotion/gone</a>. Note that the <tt class="docutils literal">sandbox</tt> value for <tt class="docutils literal">UsePrivilegeSeparation</tt> is even <a class="reference external" href="http://www.openbsd.org/cgi-bin/man.cgi/OpenBSD-current/man5/sshd_config.5?query=sshd_config&amp;sec=5">more secure</a> than the <tt class="docutils literal">yes</tt> value.</p>
</div>
<p>Now ensure that the firewall allows for ssh:</p>
<ol class="arabic simple">
<li>Start <tt class="docutils literal">yast</tt></li>
<li>Go to <tt class="docutils literal">Security and Users</tt>, <tt class="docutils literal">Firewall</tt></li>
<li>Go to <tt class="docutils literal">Allowed Services</tt></li>
<li>Ensure <tt class="docutils literal">Secure Shell Server</tt> is in the list, when not:</li>
</ol>
<blockquote>
<ol class="arabic simple">
<li>Add <tt class="docutils literal">Secure Shell Server</tt> to the list</li>
<li>Press <tt class="docutils literal">Next</tt> followed by <tt class="docutils literal">Finish</tt> to apply the changes</li>
</ol>
</blockquote>
<ol class="arabic simple" start="5">
<li>Quit <tt class="docutils literal">yast</tt></li>
</ol>
<p>Finally start <tt class="docutils literal">sshd</tt>:</p>
<pre class="literal-block">
rcsshd start
rcsshd status
</pre>
</div>
<div class="section" id="install-and-configure-noip-dynamic-dns-update-script">
<h2><a class="toc-backref" href="#id32">install and configure <cite>noip</cite> dynamic DNS update script</a></h2>
<p>The script is based on &lt;<a class="reference external" href="https://github.com/mdmower/bash-no-ip-updater.git">https://github.com/mdmower/bash-no-ip-updater.git</a>&gt;.</p>
<p>Create the below <tt class="docutils literal">/etc/noip.com.install.sh</tt> script with <tt class="docutils literal">chmod 700</tt>, then run it to install.</p>
<p>One of the things it does is move the config file outside the repository (<a class="reference external" href="https://github.com/mdmower/bash-no-ip-updater/pull/2">I've made a pull-request for that</a>) as it contains credentials.</p>
<p>Full source is at &lt;<a class="reference external" href="https://gist.github.com/jpluimers/3f8c9c024446f6c6dab3">https://gist.github.com/jpluimers/3f8c9c024446f6c6dab3</a>&gt;:</p>
<pre class="literal-block">
#! /bin/sh
#
# creates /etc/NoIP directory
# clones https://github.com/mdmower/bash-no-ip-updater.git
# copies configuration file so it is outside of the git sub-repository (and can be versioned with etckeeper)
# modifies the script to use the copied configuration file

ETC_TARGET=/etc/noip.com
LOG_TARGET=/var/log/noip.com
CONFIG_BASE=bash-no-ip-updater
CONFIG_TARGET=$CONFIG_BASE.config
SCRIPT_TARGET=noipupdater.sh
CRON_HOURLY_TARGET=/etc/cron.hourly/$SCRIPT_TARGET

mkdir $ETC_TARGET
pushd $ETC_TARGET
git clone https://github.com/mdmower/$CONFIG_BASE.git
cp $CONFIG_BASE/config $CONFIG_TARGET

mkdir -p $LOG_TARGET

# replace
## LOGDIR=&quot;$HOME/logs&quot;
# with
## LOGDIR=&quot;/var/logs/noip.com&quot;
# use double quotes to allow for variable expansion: http://stackoverflow.com/questions/17477890/expand-variables-in-sed/17477911#17477911
# escape slashes in arguments: http://www.grymoire.com/Unix/Sed.html#uh-62
echo old:
sed -n &quot;/^LOGDIR=\&quot;\$HOME\/logs\&quot;$/ p&quot; $CONFIG_TARGET
LOG_TARGET_EXPANDED=`echo &quot;$LOG_TARGET&quot; | sed 's:[]\[\^\$\.\*\/]:\\\\&amp;:g'`
#echo &quot;/^LOGDIR=\&quot;\$HOME\/logs\&quot;$/ s/\&quot;\$HOME\/logs\&quot;$/\&quot;${LOG_TARGET}\&quot;/&quot;
#echo &quot;/^LOGDIR=\&quot;\$HOME\/logs\&quot;$/ s/\&quot;\$HOME\/logs\&quot;$/\&quot;${LOG_TARGET_EXPANDED}\&quot;/&quot;
sed -e &quot;/^LOGDIR=\&quot;\$HOME\/logs\&quot;$/ s/\&quot;\$HOME\/logs\&quot;$/\&quot;${LOG_TARGET_EXPANDED}\&quot;/&quot; $CONFIG_TARGET &gt; $CONFIG_TARGET.tmp &amp;&amp; mv $CONFIG_TARGET.tmp $CONFIG_TARGET
echo new:
sed -n &quot;/^LOGDIR=\&quot;.*\&quot;$/ p&quot; $CONFIG_TARGET

pushd $CONFIG_BASE
# in ``noip.com/bash-no-ip-updater/noipupdater.sh``  replace
## CONFIGFILE=&quot;$( cd &quot;$( dirname &quot;$0&quot; )&quot; &amp;&amp; pwd )/config&quot;
# by
## CONFIGFILE=&quot;$( cd &quot;$( dirname &quot;$0&quot; )&quot; &amp;&amp; pwd ).config&quot;
# in-place sed: http://stackoverflow.com/questions/5171901/sed-command-find-and-replace-in-file-and-overwrite-file-doesnt-work-it-empties/5174368#5174368
# set tips: http://www.grymoire.com/Unix/Sed.html
## sed -e 'script script' index.html &gt; index.html.tmp &amp;&amp; mv index.html.tmp index.html
echo &quot;old:&quot;
sed -n '/^CONFIGFILE\=.*\/config&quot;$/ p' $SCRIPT_TARGET
sed -e '/^CONFIGFILE\=.*\/config&quot;$/ s/\/config&quot;$/.config&quot;/' $SCRIPT_TARGET &gt; $SCRIPT_TARGET.tmp &amp;&amp; mv $SCRIPT_TARGET.tmp $SCRIPT_TARGET
echo &quot;new:&quot;
sed -n '/^CONFIGFILE\=.*\.config&quot;$/ p' $SCRIPT_TARGET
chmod 755 $SCRIPT_TARGET
popd

popd
echo files:
find noip.com* | grep -v \.git

# http://stackoverflow.com/questions/7875540/how-do-you-write-multiple-line-configuration-file-using-bash-and-use-variables/7875614#7875614
#!/bin/bash
cat &gt;$CRON_HOURLY_TARGET &lt;&lt;EOL
#! /bin/sh
#
# Hourly job to ensure the noip.com information for this host is up-to-date.
#
$ETC_TARGET/$CONFIG_BASE/$SCRIPT_TARGET
EOL

echo Hourly crontab entry in $CRON_HOURLY_TARGET
chmod 755 $CRON_HOURLY_TARGET
cat $CRON_HOURLY_TARGET
</pre>
<p>Now modify the <tt class="docutils literal"><span class="pre">/etc/noip.com/bash-no-ip-updater.config</span></tt> file; alter these entries:</p>
<pre class="literal-block">
USERNAME=&quot;email&#64;address.com&quot;
PASSWORD=&quot;password&quot;
HOST=&quot;host.domain.com&quot;
</pre>
<div class="sidebar">
<p class="first sidebar-title">no-ip login note</p>
<p class="last">I could just use my account name (email was not needed). Other people seem to need their email. Try both.</p>
</div>
<p>Finally run <tt class="docutils literal"><span class="pre">/etc/noip.com/bash-no-ip-updater/noipupdater.sh</span></tt> ones and look at the log file <tt class="docutils literal">/var/log/noip.com/noip.log</tt> to see the result and check <tt class="docutils literal">/var/log/noip.com/last_ip</tt> if the IP-address is indeed correct.</p>
</div>
<div class="section" id="configuring-ntpd-firewall-and-jail-for-it">
<h2><a class="toc-backref" href="#id33">configuring ntpd, firewall and jail for it</a></h2>
<p>By default, OpenSuSE Tumbleweed 13.2 has <tt class="docutils literal">ntdp</tt> enabled and configured as client and server, even though some of the tools mislead into thinking the server is not working correctly.</p>
<p>But first the firewall portion:</p>
<ol class="arabic simple">
<li>Start <tt class="docutils literal">yast</tt></li>
<li>Open <tt class="docutils literal">Security and Users</tt>, then <tt class="docutils literal">Firewall</tt></li>
<li>Go to <tt class="docutils literal">Allowed Services</tt></li>
<li>Ensure <tt class="docutils literal">xntp Server</tt> is in the list, when not:</li>
</ol>
<blockquote>
<ol class="arabic simple">
<li>Add <tt class="docutils literal">xntp Server</tt> to the list</li>
<li>Press <tt class="docutils literal">Next</tt> followed by <tt class="docutils literal">Finish</tt> to apply the changes</li>
</ol>
</blockquote>
<ol class="arabic simple" start="5">
<li>Quit <tt class="docutils literal">yast</tt></li>
</ol>
<ol class="arabic simple">
<li>Start <tt class="docutils literal">yast</tt></li>
<li>Open <tt class="docutils literal">Network Services</tt>, then <tt class="docutils literal">NTP Configuration</tt></li>
<li>Go to <tt class="docutils literal">Security Settings</tt></li>
<li>Ensure <tt class="docutils literal">Run NTP Daemon in Chroot Jail</tt> is in the checked, when not:</li>
</ol>
<blockquote>
<ol class="arabic simple">
<li>Check <tt class="docutils literal">Run NTP Daemon in Chroot Jail</tt></li>
<li>Press <tt class="docutils literal">OK</tt></li>
</ol>
</blockquote>
<ol class="arabic simple" start="5">
<li>Quit <tt class="docutils literal">yast</tt></li>
</ol>
<p>An <a class="reference external" href="http://doc.ntp.org/4.2.8/ntpq.html">ntpq</a> verification shows the client portion works fine (you <a class="reference external" href="http://linux.derkeiler.com/Mailing-Lists/SuSE/2013-02/msg00442.html">could do this in the past from rcntpd status</a>, see below):</p>
<pre class="literal-block">
revue:/etc # ntpq -p
     remote           refid      st t when poll reach   delay   offset  jitter
==============================================================================
+vps.vdven.org   193.79.237.14    2 u  132  128  377    3.839    0.102   0.130
*metronoom.dmz.c .PPS.            1 u   64  128  377    4.520   -0.079   0.096
+arethusa.tweake 193.190.230.65   2 u  131  128  377    2.795    0.047   0.066
-srv.nl.margash. 113.133.43.202   3 u   58  128  377    3.371    0.919   0.390
</pre>
<p>But it won't run as a server just yet, as the deprecated <a class="reference external" href="http://doc.ntp.org/4.2.8/ntpdc.html">ntpdc</a> shows:</p>
<pre class="literal-block">
revue:/etc # ntpdc -p
localhost: timed out, nothing received
***Request timed out
</pre>
<p>This is also shown when running <cite>rcntpd status</cite> where you get message containing <a class="reference external" href="https://www.google.com/search?q=&quot;localhost%3A+timed+out%2C+nothing+received&quot;">&quot;localhost: timed out, nothing received&quot;</a>:</p>
<pre class="literal-block">
revue:/etc # rcntpd status
● ntpd.service - NTP Server Daemon
   Loaded: loaded (/usr/lib/systemd/system/ntpd.service; enabled; vendor preset: disabled)
   Active: active (running) since Tue 2015-05-26 20:45:59 CEST; 44min ago
     Docs: man:ntpd(1)
  Process: 2371 ExecStart=/usr/sbin/start-ntpd start (code=exited, status=0/SUCCESS)
 Main PID: 2383 (ntpd)
   CGroup: /system.slice/ntpd.service
           └─2383 /usr/sbin/ntpd -p /var/run/ntp/ntpd.pid -g -u ntp:ntp -i /var/lib/ntp -c /etc/ntp.conf

May 26 20:45:54 revue start-ntpd[2371]: Starting network time protocol daemon (NTPD)sntp 4.2.8p2&#64;1.3265-o Wed Apr 22 00:47:12 UTC 2015 (1)
May 26 20:45:54 revue start-ntpd[2371]: kod_init_kod_db(): Cannot open KoD db file /var/db/ntp-kod: No such file or directory
May 26 20:45:54 revue sntp[2384]: 2015-05-26 20:45:54.222429 (-0100) -0.00246 +/- 0.012134 192.168.71.1 s2 no-leap
May 26 20:45:54 revue start-ntpd[2371]: 2015-05-26 20:45:54.222429 (-0100) -0.00246 +/- 0.012134 192.168.71.1 s2 no-leap
May 26 20:45:54 revue ntpd[2383]: Listening on routing socket on fd #22 for interface updates
May 26 20:45:54 revue ntpd[2383]: switching logging to file /var/log/ntp
May 26 20:45:59 revue start-ntpd[2371]: localhost: timed out, nothing received
May 26 20:45:59 revue start-ntpd[2371]: ***Request timed out
May 26 20:45:59 revue /usr/sbin/start-ntpd[2390]: runtime configuration: keyid 1
                                                  passwd 3a84bf3
                                                  addserver 192.168.71.1
                                                  quit
May 26 20:45:59 revue systemd[1]: Started NTP Server Daemon.
</pre>
<p>It took me quite a while to figure out why these two show failures. It's because <tt class="docutils literal">ntpdc</tt> is deprecated, and it is <a class="reference external" href="https://build.opensuse.org/package/view_file/openSUSE:Factory/ntp/conf.start-ntpd?expand=1">used by conf.start-ntpd</a>. Too bad it is so hard to get the actual source DVCS of OpenSuSE so I don't know the history of that file.</p>
<div class="note">
<p class="first admonition-title">Note</p>
<p class="last">For the tests, I got inspired by <a class="reference external" href="http://www.thegeekstuff.com/2014/06/linux-ntp-server-client/">How to Install and Configure Linux NTP Server and Client</a></p>
</div>
</div>
<div class="section" id="configuring-samba">
<h2><a class="toc-backref" href="#id34">Configuring <tt class="docutils literal">samba</tt></a></h2>
<ol class="arabic simple">
<li>Start <tt class="docutils literal">yast</tt></li>
<li>Open <tt class="docutils literal">Network Services</tt>, then <tt class="docutils literal">Samba Server</tt></li>
<li>Fill in the <tt class="docutils literal">Workgroup or Domain Name</tt> (I kept it at <tt class="docutils literal">WORKGROUP</tt> as my domain-less Windows machines are configured like that)</li>
<li>Press <tt class="docutils literal">Next</tt></li>
<li>Choose the <tt class="docutils literal">Server type</tt> (I kept it at <tt class="docutils literal">Not a Domain Controller</tt> as don't run a domain)</li>
<li>Press <tt class="docutils literal">Next</tt></li>
<li>In the <tt class="docutils literal">Samba Configuration</tt> screen:</li>
</ol>
<blockquote>
<ol class="arabic simple">
<li>Ensure <tt class="docutils literal">Service Start</tt> is set to <tt class="docutils literal">During Boot</tt>.</li>
<li>Ensure <tt class="docutils literal">Open Port in Firewall</tt> is checked.</li>
<li>Press <tt class="docutils literal">OK</tt></li>
</ol>
</blockquote>
<ol class="arabic simple" start="8">
<li>Quit <tt class="docutils literal">yast</tt></li>
</ol>
<p>This will modify these files:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">/etc/apparmor.d/local/usr.sbin.smbd-shares</span></tt> (upon Samba start)</li>
<li><tt class="docutils literal">/etc/samba/smb.conf</tt></li>
<li><tt class="docutils literal">/etc/sysconfig/SuSEfirewall2</tt></li>
</ul>
<p>and add these configuration files:</p>
<ul class="simple">
<li><tt class="docutils literal">/etc/printcap</tt> (which will be auto-generated from <tt class="docutils literal">/etc/cups/printers.conf</tt> if it exists)</li>
<li><tt class="docutils literal"><span class="pre">/etc/systemd/system/multi-user.target.wants/nmb.service</span></tt></li>
<li><tt class="docutils literal"><span class="pre">/etc/systemd/system/multi-user.target.wants/smb.service</span></tt></li>
</ul>
<p>Run these commands to <a class="reference external" href="hhttps://www.samba.org/samba/docs/man/Samba-HOWTO-Collection/install.html#id2553312">test if the basic configuration was successful</a> with <a class="reference external" href="https://www.samba.org/samba/docs/man/manpages/testparm.1.html">testclient</a> and <a class="reference external" href="h">https://www.samba.org/samba/docs/man/manpages/smbclient.1.html</a>:</p>
<pre class="literal-block">
testparm /etc/samba/smb.conf
smbclient -L `hostname`
</pre>
<div class="note">
<p class="first admonition-title">Note</p>
<p class="last">During <tt class="docutils literal">smbclient</tt> you will have to type your unix password.</p>
</div>
</div>
<div class="section" id="testing-and-fixing-so-clients-can-talk-to-our-samba-server">
<h2><a class="toc-backref" href="#id35">Testing and fixing so clients can talk to our Samba server</a></h2>
<p>Now it is time to test the smb connectivity as well:</p>
<pre class="literal-block">
smbclient //`hostname`/profiles -U jeroenp
Enter jeroenp's password:
Domain=[WORKGROUP] OS=[Windows 6.1] Server=[Samba 4.2.1-3406-SUSE-oS13.2-x86_64]
tree connect failed: NT_STATUS_ACCESS_DENIED
</pre>
<div class="note">
<p class="first admonition-title">Note</p>
<p class="last">Do <strong>not</strong> try to solve the <a class="reference external" href="https://forum.manjaro.org/index.php?topic=19252.0">NT_STATUS_ACCESS_DENIED issue</a> by enabling <tt class="docutils literal">client lanman auth</tt> as this makes your system less secure (<a class="reference external" href="hhttps://www.samba.org/samba/docs/man/manpages-3/smb.conf.5.html#idp59214864">LANMAN authentication can be cracked quite easily</a>).</p>
</div>
<p>The first think to check is the samba password database, as samba uses different authentication database than the standard linux one (hence the linux password above).
Check it with <a class="reference external" href="https://www.samba.org/samba/docs/man/manpages/pdbedit.8.html">pdbedit</a> like this:</p>
<pre class="literal-block">
pdbedit --list --verbose jeroenp
</pre>
<p>If it shows <tt class="docutils literal">Username not found!</tt> then you need to add the user:</p>
<blockquote>
revue:/etc # pdbedit --create --user jeroenp
new password:
retype new password:
Unix username:        jeroenp
NT username:
Account Flags:        [U          ]
User SID:             S-1-5-21-539969646-619626457-384116915-1000
Primary Group SID:    S-1-5-21-539969646-619626457-384116915-513
Full Name:            Jeroen Pluimers
Home Directory:       \revuejeroenp.9xprofile
HomeDir Drive:        P:
Logon Script:
Profile Path:         \revueprofiles.msprofile
Domain:               REVUE
Account desc:
Workstations:
Munged dial:
Logon time:           0
Logoff time:          Wed, 06 Feb 2036 16:06:39 CET
Kickoff time:         Wed, 06 Feb 2036 16:06:39 CET
Password last set:    Wed, 27 May 2015 20:51:21 CEST
Password can change:  Wed, 27 May 2015 20:51:21 CEST
Password must change: never
Last bad password   : 0
Bad password count  : 0
Logon hours         : FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF</blockquote>
<div class="note">
<p class="first admonition-title">Note</p>
<p class="last">Do <strong>not</strong> use <a class="reference external" href="https://www.samba.org/samba/docs/man/manpages/smbpasswd.8.html">smbpasswd</a> to add the user as that only supports the <tt class="docutils literal">smbpasswd</tt> database format, <cite>whereas ``pdbedit`</cite> supports any password backend &lt;<a class="reference external" href="http://unix.stackexchange.com/questions/107032/deleting-a-samba-user-pbdedit-vs-smbpasswd-whats-the-difference/107033#107033">http://unix.stackexchange.com/questions/107032/deleting-a-samba-user-pbdedit-vs-smbpasswd-whats-the-difference/107033#107033</a>&gt;`_.</p>
</div>
<p>Now do final checks:</p>
<pre class="literal-block">
smbclient --list `hostname` --user jeroenp
smbclient //`hostname`/jeroenp -U jeroenp
</pre>
</div>
<div class="section" id="one-day-syncing-between-the-samba-password-and-system-password-storage-is-setup">
<h2>One day: <a class="reference external" href="https://www.samba.org/samba/docs/man/Samba-HOWTO-Collection/pam.html#id2667418">syncing between the Samba password and system password storage</a> is setup</h2>
<p>See <a class="reference external" href="https://www.google.com/search?q=&quot;Use+SMB+Information+for+Linux+Authentication&quot;">Use SMB Information for Linux Authentication</a>.</p>
</div>
<div class="section" id="fixing-password-synchronisation">
<h2><a class="toc-backref" href="#id37">Fixing password synchronisation?</a></h2>
<div class="note">
<p class="first admonition-title">Note</p>
<p class="last">Background reading (web-archive link as the site itself is down): <a class="reference external" href="http://web.archive.org/web/20130801222534/http://swerdna.dyndns.org/susesambaserver.html">Samba Server and Suse / openSUSE: HowTo Configure a Professional File Server on a SOHO LAN, covering Name Resolution, Authentication, Security and Shares</a>.</p>
</div>
</div>
<div class="section" id="configuring-named-bind">
<h2><a class="toc-backref" href="#id38">configuring named/BIND</a></h2>
<ol class="arabic simple">
<li>Start <tt class="docutils literal">yast</tt></li>
<li>Open <tt class="docutils literal">System</tt>, then <tt class="docutils literal">/etc/sysconfig Editor</tt></li>
<li>In <tt class="docutils literal">Configuration Options</tt>, open these tree nodes: <tt class="docutils literal">Network</tt>; <tt class="docutils literal">DNS</tt>; <tt class="docutils literal">Name Server</tt></li>
<li>Ensure the below entries have the correct values:</li>
</ol>
<blockquote>
<ol class="arabic simple">
<li><tt class="docutils literal">NAMED_RUN_CHROOTED</tt> has no value</li>
<li><tt class="docutils literal">NAMED_ARGS</tt> has no value</li>
<li><tt class="docutils literal">NAMED_CONF_INCLUDE_FILES</tt> has value <tt class="docutils literal">options logging master slaves <span class="pre">rnd-access.conf</span></tt></li>
<li><tt class="docutils literal">NAMED_INITIALIZE_SCRIPTS</tt> has value <tt class="docutils literal">createNamedConfInclude</tt> (this is the default value)</li>
</ol>
</blockquote>
<ol class="arabic simple" start="5">
<li>If any value needed to be changed, then press <tt class="docutils literal">Finish</tt> and confirm the changes.</li>
<li>Open <tt class="docutils literal">Security and Users</tt>, then <tt class="docutils literal">Firewall</tt></li>
<li>Go to <tt class="docutils literal">Allowed Services</tt></li>
<li>Ensure <tt class="docutils literal">bind DNS server</tt> is in the list, when not:</li>
</ol>
<blockquote>
<ol class="arabic simple">
<li>Add <tt class="docutils literal">bind DNS server</tt> to the list</li>
<li>Press <tt class="docutils literal">Next</tt> followed by <tt class="docutils literal">Finish</tt> to apply the changes</li>
</ol>
</blockquote>
<ol class="arabic simple" start="9">
<li>Quit <tt class="docutils literal">yast</tt></li>
</ol>
<p>Add an empty <tt class="docutils literal">/etc/named.d/forwarders.conf</tt>.</p>
<p>Add <tt class="docutils literal">/etc/named.d/master</tt>:</p>
<pre class="literal-block">
zone &quot;4delphi.com&quot; {
        type master;
        file &quot;master/4delphi.com&quot;;
};

zone &quot;pluimers.com&quot; {
        type master;
        file &quot;master/pluimers.com&quot;;
};

zone &quot;pluimers.localnet&quot; {
        type master;
        file &quot;master/pluimers.localnet&quot;;
        notify no;
        allow-query     { internals; };
        allow-transfer  { internals; };
};

zone &quot;71.168.192.IN-ADDR.ARPA&quot; {
        type master;
        file &quot;master/192.168.71&quot;;
        notify no;
        allow-query     { internals; };
        allow-transfer  { internals; };
};

zone &quot;171.168.192.IN-ADDR.ARPA&quot; {
        type master;
        file &quot;master/192.168.171&quot;;
        notify no;
        allow-query     { internals; };
        allow-transfer  { internals; };
};
</pre>
<p>Add <tt class="docutils literal">/etc/named.d/options</tt>:</p>
<pre class="literal-block">
acl internals {
            127.0.0.1/24;
                192.168.71.0/16;
                192.168.171.0/16;
          };

acl externals {
            82.161.131.169; // jeroen - ADSL xs4all
            80.100.143.119; // jeroen - fiber xs4all
            37.153.243.241; // jeroen - fiber helden van nu 1 - router
            37.153.243.242; // jeroen - fiber helden van nu 2 - server DNS 1
            37.153.243.243; // jeroen - fiber helden van nu 3 - server
            37.153.243.244; // jeroen - fiber helden van nu 4 - server
            37.153.243.245; // jeroen - fiber helden van nu 5 - server
            37.153.243.246; // jeroen - fiber helden van nu 6 - server DNS 2
              62.195.34.14; // jeroen - Cable UPC (tijdelijk)
             136.243.21.95; // remco/cor - Hetzner host - ziggy.domainnetwerk.info
             83.163.69.172; // martijn - mwpg.xs4all.nl
                   109.70.6.22; // jaco - Dynasol
        };
</pre>
<p>Ensure these files exist:</p>
<p><tt class="docutils literal">/var/lib/named/master/192.168.171</tt>:</p>
<pre class="literal-block">
$TTL 1H
&#64;               IN      SOA     ns.pluimers.localnet.   root.4delphi.com. (
                        2005011803 ; serial
                        1H         ; refresh
                        900        ; retry
                        3W         ; expire
                        2H         ; default_ttl
                        )
&#64;               IN      NS      ns.pluimers.localnet.
80             IN      PTR     jp1.pluimers.localnet.
80             IN      PTR     snap.pluimers.localnet.
80             IN      PTR     ns.pluimers.localnet.
70             IN      PTR     snip.pluimers.localnet.
</pre>
<p><tt class="docutils literal">/var/lib/named/master/192.168.71</tt>:</p>
<pre class="literal-block">
$TTL 1H
&#64;               IN      SOA     ns.pluimers.localnet.   root.4delphi.com. (
                        2005011803 ; serial
                        1H         ; refresh
                        900        ; retry
                        3W         ; expire
                        2H         ; default_ttl
                        )
&#64;               IN      NS      ns.pluimers.localnet.
80             IN      PTR     jp1.pluimers.localnet.
80             IN      PTR     snap.pluimers.localnet.
80             IN      PTR     ns.pluimers.localnet.
70             IN      PTR     snip.pluimers.localnet.
</pre>
<p><tt class="docutils literal">/var/lib/named/master/named.local</tt>:</p>
<pre class="literal-block">
$TTL 2H
&#64;               IN      SOA     localhost.      root.localhost. (
                        2004111611 ; serial
                        1H         ; refresh
                        900        ; retry
                        3W         ; expire
                        2H         ; default_ttl
                        )
1               IN      PTR     localhost.
&#64;               IN      NS      localhost.
</pre>
<p><tt class="docutils literal">/var/lib/named/master/pluimers.localnet</tt>:</p>
<pre class="literal-block">
$TTL 2H
&#64;               IN      SOA     ns.pluimers.localnet.    root.4delphi.com. (
                        2004111615 ; serial
                        1H         ; refresh
                        900        ; retry
                        3W         ; expire
                        2H         ; default_ttl
                        )
&#64;                       IN      MX      5       mail.pluimers.com.
&#64;                       IN      NS      ns.pluimers.localnet.
&#64;                       IN      A       192.168.71.80
localhost               IN      A       127.0.0.1
jp1                     IN      A       192.168.71.80
ns                      IN      A       192.168.71.80
snap                    IN      A       192.168.71.80
snip                    IN      A       192.168.71.70
</pre>
<p><tt class="docutils literal">/var/lib/named/master/pluimers.com</tt>:</p>
<pre class="literal-block">
to fill in later
</pre>
<p><tt class="docutils literal">/var/lib/named/master/4delphi.com</tt>:</p>
<pre class="literal-block">
to fill in later
</pre>
<p>Finally stop/start the named service:</p>
<pre class="literal-block">
rcnamed stop
rcnamed start
rcnamed status
</pre>
<div class="note">
<p class="first admonition-title">Note</p>
<p>Check if your zone files are correct by executing <a class="reference external" href="http://www.cyberciti.biz/faq/howto-linux-unix-zone-file-validity-checking/">named-checkzone</a>:</p>
<pre class="literal-block">
named-checkzone 4delphi.com /var/lib/named/master/4delphi.com
named-checkzone pluimers.com /var/lib/named/master/pluimers.com
</pre>
<p>Check if your named configuration is correct by executing <a class="reference external" href="http://www.cyberciti.biz/tips/howto-linux-unix-check-dns-file-errors.html">named-checkconf</a>:</p>
<pre class="literal-block">
named-checkconf /etc/named.conf
</pre>
<p>Check if <tt class="docutils literal">named</tt> delivers the correct zone:</p>
<pre class="literal-block">
dig &#64;localhost axfr 4delphi.com
dig &#64;localhost axfr pluimers.com
</pre>
<p>See:</p>
<ul class="simple">
<li><a class="reference external" href="http://www.cyberciti.biz/tips/howto-linux-unix-check-dns-file-errors.html">Check BIND – DNS Server configuration file for errors with named-checkconf tools</a></li>
<li><a class="reference external" href="hhttp://www.cyberciti.biz/faq/howto-linux-unix-zone-file-validity-checking/">Troubleshoot Linux / UNIX bind dns server zone problems with named-checkzone tool</a></li>
</ul>
<p><a class="reference external" href="https://ask.fedoraproject.org/en/question/24288/how-to-debug-bind-conf-and-zone-files/">Check the named configuration</a>:</p>
<pre class="literal-block">
named-checkconf /etc/named.conf
</pre>
<p><a class="reference external" href="http://www.ewhathow.com/2013/09/how-do-i-check-bind-zone-file-for-errors/">Check each named zone</a>:</p>
<pre class="last literal-block">
named-checkzone localhost /var/lib/named/master/4delphi.com
named-checkzone localhost /var/lib/named/master/pluimers.com
</pre>
</div>
</div>
<div class="section" id="ensure-that-var-lib-named-master-gets-synced-to-etc-named-master">
<h2><a class="toc-backref" href="#id39">Ensure that <tt class="docutils literal">/var/lib/named/master</tt> gets synced to <tt class="docutils literal">/etc/named/master</tt></a></h2>
<p>Based on these links, I've added a sync script.</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/joeyh/etckeeper#configuration">etckeeper configuration documentation</a></li>
<li><a class="reference external" href="http://www.tutorialspoint.com/unix/unix-using-variables.htm">unix: using variables</a></li>
</ul>
<p>I stored it in <tt class="docutils literal"><span class="pre">/etc/etckeeper/pre-commit.d/10rsync-var-lib-named-master</span></tt>:</p>
<pre class="literal-block">
#! /bin/sh
## http://www.tutorialspoint.com/unix/unix-using-variables.htm
TARGET=/etc/named/master
mkdir -p $TARGET
rsync -avloz /var/lib/named/master/ $TARGET/
</pre>
<p>You need to give this script the right permissons, otherwise <tt class="docutils literal">etckeeper</tt> wil skip it:</p>
<pre class="literal-block">
chmod 755 /etckeeper/pre-commit.d/10rsync-var-lib-named-master.sh
</pre>
</div>
<div class="section" id="adding-aliases-for-commands-removed-in-net-tools">
<h2><a class="toc-backref" href="#id40">Adding aliases for commands removed in <tt class="docutils literal"><span class="pre">net-tools</span></tt></a></h2>
<p>Add this to <tt class="docutils literal">/etc/bash.bashrc.local</tt>:</p>
<pre class="literal-block">
# stuff removed from net-tools
# see https://features.opensuse.org/317197 and https://build.opensuse.org/package/view_file/network:utilities/net-tools/net-tools.changes
## Because of changes on Thu Apr 10 12:33:41 UTC 2014
alias &quot;arp=echo 'use \&quot;ip neigh\&quot; or \&quot;ip -r neight\&quot;' &amp;&amp; ip neigh&quot;
alias &quot;ifconfig=echo 'use \&quot;ip a\&quot;' &amp;&amp; ip a&quot;
alias &quot;netstat= echo 'use \&quot;ss\&quot; or \&quot;ss -r\&quot;' &amp;&amp; ss&quot;
alias &quot;route=echo 'use \&quot;ip r\&quot;' &amp;&amp; ip r&quot;
## Because of changes on Sun Mar 29 00:41:21 UTC 2015
alias &quot;ipmaddr=echo 'use \&quot;ip maddr\&quot;' &amp;&amp; ip maddr&quot;
alias &quot;iptunnel=echo 'use \&quot;ip tunnel\&quot;' &amp;&amp; ip tunnel&quot;
</pre>
</div>
<div class="section" id="configuring-monit-monitoring-service">
<h2><a class="toc-backref" href="#id41">Configuring <tt class="docutils literal">monit</tt> monitoring service</a></h2>
<p>At first, <a class="reference external" href="https://software.opensuse.org/package/monit">monit</a> won't run:</p>
<pre class="literal-block">
revue:~ # rcmonit restart
redirecting to systemctl restart monit.service
Failed to restart monit.service: Unit monit.service failed to load: No such file or directory.
</pre>
<p>Even though it is an offical package, it is missing the <a class="reference external" href="http://www.freedesktop.org/software/systemd/man/systemd.service.html">.service file</a>.</p>
<p>That is easy to fix by downloading and modifying the <tt class="docutils literal">monit.service</tt> template <a class="reference external" href="https://bitbucket.org/tildeslash/monit/raw/master/system/startup/monit.service.in">https://bitbucket.org/tildeslash/monit/raw/master/system/startup/monit.service.in</a>:</p>
<pre class="literal-block">
#! /bin/sh
#
# Fixes this error:
#    revue:~ # rcmonit restart
#    redirecting to systemctl restart monit.service
#    Failed to restart monit.service: Unit monit.service failed to load: No such file or directory.
SERVICE_TARGET=monit.service
pushd /etc/systemd/system/
# http://stackoverflow.com/questions/13735051/curl-and-capturing-output-to-a-file
curl https://bitbucket.org/tildeslash/monit/raw/master/system/startup/monit.service.in -o $SERVICE_TARGET
# escape slashes in arguments: http://www.grymoire.com/Unix/Sed.html#uh-62
## might need to get rid of the backtick and replace \\ by \, see:
# http://unix.stackexchange.com/questions/5778/whats-the-difference-between-stuff-and-stuff/5782#5782
MONIT_EXPANDED=`echo &quot;$(which monit)&quot; | sed 's:[]\[\^\$\.\*\/]:\\\\&amp;:g'`
echo SERVICE_TARGET=$SERVICE_TARGET
echo MONIT_EXPANDED=$MONIT_EXPANDED

echo old:
sed -n &quot;/&#64;prefix&#64;\/bin\/monit/ p&quot; $SERVICE_TARGET
# replace &#64;prefix&#64; with the directory where monit resides
# replace &#64;sysconfigdir&#64; with etc
sed -e &quot;/&#64;prefix&#64;\/bin\/monit/ s/&#64;prefix&#64;\/bin\/monit/${MONIT_EXPANDED}/&quot; $SERVICE_TARGET &gt; $SERVICE_TARGET.tmp &amp;&amp; mv $SERVICE_TARGET.tmp $SERVICE_TARGET
sed -e &quot;/&#64;sysconfdir&#64;/ s/&#64;sysconfdir&#64;/etc/&quot; $SERVICE_TARGET &gt; $SERVICE_TARGET.tmp &amp;&amp; mv $SERVICE_TARGET.tmp $SERVICE_TARGET
echo new:
sed -n &quot;/monitrc/ p&quot; $SERVICE_TARGET

chmod 755 $SERVICE_TARGET
popd
systemctl enable monit.service
systemctl status monit.service
systemctl start monit.service
</pre>
<p>But it still doesn't start, as <a class="reference external" href="https://www.google.com/search?q=journalctl">journalctl</a> (the logging part part of <a class="reference external" href="https://en.wikipedia.org/wiki/Systemd">systemd</a>) shows:</p>
<pre class="literal-block">
revue:/etc # journalctl _COMM=monit
-- Logs begin at Sat 2015-06-06 10:05:54 CEST, end at Sat 2015-06-06 15:00:01 CEST. --
Jun 06 10:01:24 revue monit[1496]: Error opening the idfile '/run/monit/.monit.id' -- No such file or directory
Jun 06 10:01:24 revue monit[1496]: Error opening the idfile '/run/monit/.monit.id' -- No such file or directory
Jun 06 10:01:24 revue monit[1496]: Starting Monit 5.10 daemon with http interface at [localhost:2812]
Jun 06 10:01:24 revue monit[1496]: Error opening pidfile '&#64;&#64;PIDDIR&#64;&#64;/monit.pid' for writing -- No such file or directory
Jun 06 10:01:24 revue monit[1496]: Monit daemon died
Jun 06 10:01:24 revue monit[1496]: Starting Monit 5.10 daemon with http interface at [localhost:2812]
Jun 06 10:01:24 revue monit[1551]: Error opening the idfile '/run/monit/.monit.id' -- No such file or directory
Jun 06 10:01:24 revue monit[1551]: Error opening the idfile '/run/monit/.monit.id' -- No such file or directory
Jun 06 10:01:24 revue monit[1551]: No daemon process found
Jun 06 10:01:24 revue monit[1551]: No daemon process found
</pre>
<div class="note">
<p class="first admonition-title">Note</p>
<p>Note that <a class="reference external" href="https://www.google.com/search?q=journalctl">journalctl</a> can feel a bit complex for casual users, so to get <tt class="docutils literal">/var/log/messages</tt> back you might want to install <tt class="docutils literal">rsyslog</tt> as explained by <a class="reference external" href="https://forums.opensuse.org/showthread.php/505084-Whither-var-log-messages">Whither /var/log/messages?</a>.</p>
<p>For a comparison, read:</p>
<ul class="last simple">
<li><a class="reference external" href="http://blog.delouw.ch/2013/07/24/why-journalctl-is-cool-and-syslog-will-survive-for-another-decade/">Why journalctl is cool and syslog will survive for another decade « Luc de Louw's Blog</a>.</li>
<li><a class="reference external" href="https://docs.oracle.com/cd/E52668_01/E54670/html/ol7-log-sec.html">3.8 Configuring and Using System Logging</a>.</li>
</ul>
</div>
<p>A quick look into <tt class="docutils literal">/etc/monitrc</tt> reveals the initialisation of the <tt class="docutils literal">monit</tt> package forgot to create <tt class="docutils literal"><span class="pre">/run/monit/.monit.id</span></tt>:</p>
<pre class="literal-block">
revue:/etc # grep &quot;\.monit\.id&quot; /etc/monitrc
## default the file is placed in $HOME/.monit.id.
set idfile /run/monit/.monit.id
</pre>
<p>The cause is that the <tt class="docutils literal">idfile</tt> must both exist (see the error message) <a class="reference external" href="https://mmonit.com/wiki/MMonit/FAQ#monitid">and have a unique id in it</a>.</p>
<p>If it exists but does not have a valid id, then you get this error:</p>
<pre class="literal-block">
Jun 06 15:34:13 revue systemd[1]: Starting Pro-active monitoring utility for unix systems...
Jun 06 15:34:13 revue monit[4404]: Error reading id from file '/run/monit/.monit.id'
Jun 06 15:34:13 revue monit[4404]: Error reading id from file '/run/monit/.monit.id'
Jun 06 15:34:13 revue monit[4404]: Starting Monit 5.10 daemon with http interface at [localhost:2812]
Jun 06 15:34:13 revue systemd[1]: monit.service: main process exited, code=exited, status=1/FAILURE
</pre>
<p>Both issues is easily fixed by creating and running this <tt class="docutils literal"><span class="pre">/etc/monit-create-idfile.sh</span></tt> script:</p>
<pre class="literal-block">
#! /bin/sh
#
# creates idfile from configuration in in /etc/monitrc
ETC_TARGET=/etc/monitrc
# http://unix.stackexchange.com/questions/84922/extract-a-part-of-one-line-from-a-file-with-sed/84957#84957
# trick: search and edit and print at the same time
ID_FILE=`sed -n -e &quot;/^set idfile .*monit.id$/ s/^set idfile // p&quot; $ETC_TARGET`
echo id file: $ID_FILE
# http://stackoverflow.com/questions/6121091/get-file-directory-path-from-filepath/6121114#6121114
ID_FILE_DIRECTORY=$(dirname &quot;${ID_FILE}&quot;)
echo id file directory: $ID_FILE_DIRECTORY
ls -al $ID_FILE
mkdir -p $ID_FILE_DIRECTORY
touch $ID_FILE
ls -al $ID_FILE
echo y | monit --resetid
cat $ID_FILE &amp;&amp; echo
</pre>
<p>Finally we caome to the last error: some more replacement needs to take place to prevent this error because <tt class="docutils literal">monit</tt> cannot find its <a class="reference external" href="http://stackoverflow.com/questions/8296170/what-is-a-pid-file-and-what-does-it-contain/8296204#8296204">pid</a> file:</p>
<pre class="literal-block">
Jun 06 16:20:48 revue monit[4760]: Error opening pidfile '&#64;&#64;PIDDIR&#64;&#64;/monit.pid' for writing -- No such file or directory
Jun 06 16:20:48 revue monit[4760]: Monit daemon died
</pre>
<p>This is then fixed by creating and running this <tt class="docutils literal"><span class="pre">/etc/monitrc-fix.sh</span></tt>:</p>
<pre class="literal-block">
#! /bin/sh
#
# fixes the pidfile in /etc/monitrc
ETC_TARGET=/etc/monitrc
# use double quotes to allow for variable expansion: http://stackoverflow.com/questions/17477890/expand-variables-in-sed/17477911#17477911
# escape slashes in arguments: http://www.grymoire.com/Unix/Sed.html#uh-62
echo old:
sed -n &quot;/^# set pidfile \/var\/run\/monit.pid$/ p&quot; $ETC_TARGET
sed -e &quot;/^# set pidfile \/var\/run\/monit.pid$/ s/^# //&quot; $ETC_TARGET &gt; $ETC_TARGET.tmp &amp;&amp; mv $ETC_TARGET.tmp $ETC_TARGET
echo new:
sed -n &quot;/^set pidfile \/var\/run\/monit.pid$/ p&quot; $ETC_TARGET
systemctl status monit.service
systemctl start monit.service
</pre>
<p>More <tt class="docutils literal">monit</tt> configuration tips (including setting up <a class="reference external" href="https://en.wikipedia.org/wiki/HTTPS">HTTPs</a> with a <a class="reference external" href="https://en.wikipedia.org/wiki/Self-signed_certificate">self-signed certificate</a> - imporant as <tt class="docutils literal">monit</tt> uses plain username/password <a class="reference external" href="https://en.wikipedia.org/wiki/Basic_access_authentication">http basic authentication</a>) are at:</p>
<ul class="simple">
<li><a class="reference external" href="http://xmodulo.com/server-monitoring-system-monit.html">How to set up server monitoring system with Monit - Xmodulo</a>.</li>
<li><a class="reference external" href="http://www.itzgeek.com/how-tos/linux/opensuse/install-monit-on-opensuse-13-2.html">Install Monit on openSUSE 13.2</a>.</li>
</ul>
</div>
<div class="section" id="configuring-apache2-for-the-first-time">
<h2><a class="toc-backref" href="#id42">Configuring apache2 for the first time</a></h2>
<p>To display the <em>Apache</em> version:</p>
<pre class="literal-block">
# httpd2 -v
Server version: Apache/2.4.12 (Linux/SUSE)
Server built:   2015-06-09 09:24:07.000000000 +0000
</pre>
<p>Or since both <tt class="docutils literal">httpd</tt> and <tt class="docutils literal">httpd2</tt> point to the same file:</p>
<pre class="literal-block">
# httpd2 -v
Server version: Apache/2.4.12 (Linux/SUSE)
Server built:   2015-06-09 09:24:07.000000000 +0000

# ls -al `which httpd2` `which httpd`
lrwxrwxrwx 1 root root 23 Jun 20 15:26 /usr/sbin/httpd -&gt; /usr/sbin/httpd-prefork
lrwxrwxrwx 1 root root 23 Jun 20 15:26 /usr/sbin/httpd2 -&gt; /usr/sbin/httpd-prefork
</pre>
<p>To verify your configuration files are correct, use this command before restarting the apache2 httpd2 server:</p>
<pre class="literal-block">
httpd2 -S
</pre>
<p>Apart from replacing <tt class="docutils literal">combined</tt> by <tt class="docutils literal">vhost_combined</tt>, you might want to ensure logging is done for each vhost in a separate file: it makes checkout out vhost issues a lot easier.</p>
<p>You can either use the default <tt class="docutils literal">vhost.template</tt> for that, or the <a class="reference external" href="http://wiki.apache.org">apache wiki</a> examples: <a class="reference external" href="https://wiki.apache.org/httpd/ExampleVhosts">https://wiki.apache.org/httpd/ExampleVhosts</a></p>
<p>This is my diff between the default <tt class="docutils literal">vhost.template `` and ``pluimers.com.conf</tt> in <tt class="docutils literal">/etc/apache2/vhosts.d</tt>:</p>
<pre class="literal-block">
/etc/apache2/vhosts.d # diff pluimers.com.conf vhost.template
1c1
&lt; # pluimers.com apache2 vhost configuration based on
---
&gt; #
15,19c15,17
&lt; # &lt;VirtualHost *:80&gt;
&lt; &lt;VirtualHost *&gt;
&lt;     ServerAlias *.pluimers.com
&lt;     ServerAdmin jeroen.pluimers.com+pluimers.com&#64;gmail.com
&lt;     ServerName revue
---
&gt; &lt;VirtualHost *:80&gt;
&gt;     ServerAdmin webmaster&#64;dummy-host.example.com
&gt;     ServerName dummy-host.example.com
24c22
&lt;     DocumentRoot /srv/www/vhosts/pluimers.com
---
&gt;     DocumentRoot /srv/www/vhosts/dummy-host.example.com
27,30c25,26
&lt;     # ErrorLog /var/log/apache2/pluimers.com/error_log
&lt;     ErrorLog /var/log/apache2/pluimers.com-error_log
&lt;     # CustomLog /var/log/apache2/pluimers.com/access_log vhost_combined
&lt;     CustomLog /var/log/apache2/pluimers.com-access_log vhost_combined
---
&gt;     ErrorLog /var/log/apache2/dummy-host.example.com-error_log
&gt;     CustomLog /var/log/apache2/dummy-host.example.com-access_log combined
59c55
&lt;     ScriptAlias /cgi-bin/ &quot;/srv/www/vhosts/pluimers.com/cgi-bin/&quot;
---
&gt;     ScriptAlias /cgi-bin/ &quot;/srv/www/vhosts/dummy-host.example.com/cgi-bin/&quot;
64c60
&lt;     &lt;Directory &quot;/srv/www/vhosts/pluimers.com/cgi-bin&quot;&gt;
---
&gt;     &lt;Directory &quot;/srv/www/vhosts/dummy-host.example.com/cgi-bin&quot;&gt;
102c98
&lt;     &lt;Directory &quot;/srv/www/vhosts/pluimers.com&quot;&gt;
---
&gt;     &lt;Directory &quot;/srv/www/vhosts/dummy-host.example.com&quot;&gt;
137d132
&lt; &lt;/VirtualHost&gt;
138a134
&gt; &lt;/VirtualHost&gt;
</pre>
<p>Note that I experimented with a log directory per domain like <tt class="docutils literal">/var/log/apache2/pluimers.com/</tt>, but these won't be auto-created, like <tt class="docutils literal">httpd2 <span class="pre">-S</span></tt> shows:</p>
<pre class="literal-block">
/etc/apache2/vhosts.d # httpd2 -S
VirtualHost configuration:
...
(2)No such file or directory: AH02291: Cannot access directory '/var/log/apache2/pluimers.com/' for error log of vhost defined at /etc/apache2/vhosts.d/pluimers.com.conf:16
AH00014: Configuration check failed
</pre>
<p>Note that <tt class="docutils literal">httpd2 <span class="pre">-S</span></tt> by default does not execute ``
This means that if you have <tt class="docutils literal">SSL</tt> configured, <tt class="docutils literal">httpd2 <span class="pre">-S</span></tt> will not take that into account the <tt class="docutils literal">APACHE_SERVER_FLAGS</tt> setting in <tt class="docutils literal">/etc/sysconfig/apache2</tt></p>
<p><a class="reference external" href="http://web.ornl.gov/~jar/Apache/SSL_in_Apache_2.html">Workaround from another frustrated user</a> which <a class="reference external" href="http://serverfault.com/questions/702155/why-doesnt-httpd2-s-catch-ssl-certificate-issues-whereas-systemctl-restart/702156#comment868640_702156">one day I will make easier to use</a>:</p>
<pre class="literal-block">
httpd2 -D SSL -S
</pre>
<p>The same frustrated user also suggested to make this small change in <tt class="docutils literal">/etc/sysconfig/apache2</tt>, from</p>
<blockquote>
APACHE_LOGLEVEL=&quot;warn&quot;</blockquote>
<p>to:</p>
<pre class="literal-block">
APACHE_LOGLEVEL=&quot;debug&quot;
</pre>
<div class="sidebar">
<p class="first sidebar-title">Notes when updating (vhosts) configuration from Apache 2.2 to Apache 2.4:</p>
<p>Instead of using <a class="reference external" href="http://httpd.apache.org/docs/2.4/mod/mod_access_compat.html">mod_access_compat</a> modify the configuration files to use the directives in <a class="reference external" href="http://httpd.apache.org/docs/2.4/mod/mod_authz_host.html">mod_authz_host</a>.</p>
<p>See <a class="reference external" href="http://httpd.apache.org/docs/2.4/upgrading.html">Upgrading to 2.4 from 2.2</a></p>
<p>Replace the lines:</p>
<pre class="literal-block">
Order deny,allow
Deny from all
</pre>
<p>with:</p>
<pre class="literal-block">
Require all denied
</pre>
<p>Replace the lines:</p>
<pre class="literal-block">
Order allow,deny
Allow from all
</pre>
<p>with:</p>
<pre class="literal-block">
Require all granted
</pre>
<p>More background info:</p>
<ul class="simple">
<li>Denying: <a class="reference external" href="https://systembash.com/apache-2-4-upgrade-and-the-invalid-command-order-error/">Apache 2.4 Upgrade and the &quot;Invalid Command 'Order'&quot; Error</a></li>
<li>Granting: <a class="reference external" href="http://brianflove.com/2014/04/23/upgrading-to-apache-2-4-from-apache-http-server-2-2-x/">Upgrading to Apache 2.4 from Apache HTTP Server 2.2.x</a></li>
</ul>
<p><strong>Common problems when upgrading</strong></p>
<ul class="last simple">
<li>Startup errors:<ul>
<li><tt class="docutils literal">Invalid command 'User', perhaps misspelled or defined by a module not included in the server configuration</tt> - load module <a class="reference external" href="http://httpd.apache.org/docs/2.4/mod/mod_unixd.html">mod_unixd</a></li>
<li><tt class="docutils literal">Invalid command 'Require', perhaps misspelled or defined by a module not included in the server configuration</tt>, or <tt class="docutils literal">Invalid command 'Order', perhaps misspelled or defined by a module not included in the server configuration</tt> - load module <a class="reference external" href="http://httpd.apache.org/docs/2.4/mod/mod_access_compat.html">mod_access_compat</a>, or update configuration to 2.4 authorization directives.</li>
<li><tt class="docutils literal">Ignoring deprecated use of DefaultType in line NN of /path/to/httpd.conf</tt> - remove <a class="reference external" href="http://httpd.apache.org/docs/2.4/mod/core.html#defaulttype">DefaultType</a> and replace with other configuration settings.</li>
<li><tt class="docutils literal">Invalid command 'AddOutputFilterByType', perhaps misspelled or defined by a module not included in the server configuration</tt> - <a class="reference external" href="http://httpd.apache.org/docs/2.4/mod/mod_filter.html#addoutputfilterbytype">AddOutputFilterByType</a> has moved from the core to mod_filter, which must be loaded.</li>
</ul>
</li>
<li>Errors serving requests:<ul>
<li><tt class="docutils literal">configuration error: couldn't check user: /path</tt> - load module <a class="reference external" href="http://httpd.apache.org/docs/2.4/mod/mod_authn_core.html">mod_authn_core</a>.</li>
<li><tt class="docutils literal">.htaccess files aren't being processed</tt> - Check for an appropriate <a class="reference external" href="http://httpd.apache.org/docs/2.4/mod/core.html#allowoverride">AllowOverride</a> directive; the default changed to <tt class="docutils literal">None</tt> in 2.4.</li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="getting-and-running-testssl-sh">
<h2><a class="toc-backref" href="#id43">Getting and running <tt class="docutils literal">testssl.sh</tt></a></h2>
<p>Simple steps from a non-root account:</p>
<pre class="literal-block">
git clone https://github.com/drwetter/testssl.sh.git
cd testssl.sh

OPENSSL=./openssl-bins/openssl-1.0.2-chacha.pm/openssl32-1.0.2pm-krb5.chacha+poly ./testssl.sh beginend.net
OPENSSL=./testssl.sh beginend.net
OPENSSL=./openssl-bins/openssl-1.0.2-chacha.pm/openssl32-1.0.2pm-krb5.chacha+poly ./testssl.sh www.beginend.net
OPENSSL=./testssl.sh www.beginend.net
</pre>
</div>
<div class="section" id="login-reboot-fritz-box">
<h2><a class="toc-backref" href="#id44">Login / Reboot Fritz!Box</a></h2>
<p>There is a bash script for Fritz!Box access at &lt;<a class="reference external" href="https://github.com/jpluimers/bash-fritzclient">https://github.com/jpluimers/bash-fritzclient</a>&gt;.</p>
<p>Installation is simple:</p>
<ol class="arabic simple">
<li>Go to <tt class="docutils literal">/etc</tt></li>
<li><tt class="docutils literal">git clone <span class="pre">https://github.com/jpluimers/bash-fritzclient.git</span></tt></li>
<li>Copy <tt class="docutils literal"><span class="pre">bash-fritzclient\bash-fritzclient.config.template</span></tt> to <tt class="docutils literal"><span class="pre">/etc/bash-fritzclient.template</span></tt></li>
<li>Configure <tt class="docutils literal"><span class="pre">/etc/bash-fritzclient.template</span></tt>.</li>
</ol>
</div>
<div class="section" id="configuring-and-running-shellinabox-with-ssh">
<h2><a class="toc-backref" href="#id45">configuring and running shellinabox with ssh</a></h2>
<p>A great tool for configuring your machine over a connection not allowing ssh is <a class="reference external" href="http://shellinabox.com">shellinabox</a>.</p>
<p>Certificates are in <tt class="docutils literal">/etc/shellinabox/certs</tt>.</p>
<p>After installation, it isn't running:</p>
<pre class="literal-block">
revue:/etc/shellinabox/certs # systemctl status shellinabox.service
● shellinabox.service - LSB: shellinabox
   Loaded: loaded (/etc/init.d/shellinabox)
   Active: inactive (dead)
     Docs: man:systemd-sysv-generator(8)

revue:/etc/shellinabox/certs # systemctl enable shellinabox.service
shellinabox.service is not a native service, redirecting to /sbin/chkconfig.
Executing /sbin/chkconfig shellinabox on
revue:/etc/shellinabox/certs # systemctl start shellinabox.service
revue:/etc/shellinabox/certs # systemctl status shellinabox.service
● shellinabox.service - LSB: shellinabox
   Loaded: loaded (/etc/init.d/shellinabox)
   Active: active (running) since Tue 2015-06-09 19:56:21 CEST; 20s ago
     Docs: man:systemd-sysv-generator(8)
  Process: 4997 ExecStart=/etc/init.d/shellinabox start (code=exited, status=0/SUCCESS)
   CGroup: /system.slice/shellinabox.service
           ├─5030 /usr/bin/shellinaboxd --background=/var/run/shellinaboxd.pid -u shellinabox -s /:SSH -c /etc/shellinabox/certs
           └─5031 /usr/bin/shellinaboxd --background=/var/run/shellinaboxd.pid -u shellinabox -s /:SSH -c /etc/shellinabox/certs

Jun 09 19:56:20 revue shellinabox[4997]: No shellinabox certificate found, creating one now...
Jun 09 19:56:20 revue shellinabox[4997]: Generating a 2048 bit RSA private key
Jun 09 19:56:20 revue shellinabox[4997]: .................................+++
Jun 09 19:56:21 revue shellinabox[4997]: .............................................................+++
Jun 09 19:56:21 revue shellinabox[4997]: unable to write 'random state'
Jun 09 19:56:21 revue shellinabox[4997]: writing new private key to '/tmp/create-ssl-key-7GwyL'
Jun 09 19:56:21 revue shellinabox[4997]: -----
Jun 09 19:56:21 revue shellinabox[4997]: Created certificate: SHA1 Fingerprint=1B:AE:9D:C3:57:37:34:BB:64:79:0D:3D:D4:B9:50:54:9F:FE:FC:82
Jun 09 19:56:21 revue shellinabox[4997]: Starting shellinabox ..done
Jun 09 19:56:21 revue systemd[1]: Started LSB: shellinabox.
revue:/etc/shellinabox/certs # ls -al
total 12
drwxr-xr-x 1 root        root          70 Jun  9 19:56 .
drwxr-xr-x 1 root        root          10 May 17 10:41 ..
lrwxrwxrwx 1 root        root          15 Jun  9 19:56 064fecbc.0 -&gt; certificate.pem
lrwxrwxrwx 1 root        root          15 Jun  9 19:56 b3543706.0 -&gt; certificate.pem
-rw------- 1 shellinabox shellinabox 2916 Jun  9 19:56 certificate.pem
revue:/etc/shellinabox/certs # nmap -sV -p 4200 localhost

Starting Nmap 6.47 ( http://nmap.org ) at 2015-06-09 19:58 CEST
Nmap scan report for localhost (127.0.0.1)
Host is up (0.00013s latency).
PORT     STATE SERVICE VERSION
4200/tcp open  http    ShellInABox httpd

Service detection performed. Please report any incorrect results at http://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 11.49 seconds
</pre>
<p>This will work locally:</p>
<pre class="literal-block">
lynx http://localhost:4200
</pre>
<p>Remotely, it needs the firewall to be enabled for it:</p>
<ol class="arabic simple">
<li>Start <tt class="docutils literal">yast</tt></li>
<li>Go to <tt class="docutils literal">Security and Users</tt>, <tt class="docutils literal">Firewall</tt></li>
<li>Go to <tt class="docutils literal">Allowed Services</tt></li>
<li>Ensure <tt class="docutils literal">Shellinabox</tt> is in the list, when not:</li>
</ol>
<blockquote>
<ol class="arabic simple">
<li>Add <tt class="docutils literal">Shellinabox</tt> to the list</li>
<li>Press <tt class="docutils literal">Next</tt> followed by <tt class="docutils literal">Finish</tt> to apply the changes</li>
</ol>
</blockquote>
<ol class="arabic simple" start="5">
<li>Quit <tt class="docutils literal">yast</tt></li>
</ol>
<p>Now it works, but note that the https isn't really secure. Chrome will show <tt class="docutils literal">ERR_SSL_VERSION_OR_CIPHER_MISMATCH</tt>, and this will show far more details:</p>
<pre class="literal-block">
jeroenp&#64;revue:~/testssl.sh&gt; OPENSSL=./openssl-bins/openssl-1.0.2-chacha.pm/openssl32-1.0.2pm-krb5.chacha+poly ./testssl.sh localhost:4200
</pre>
<p>So the best is setting up an Apache redirect as shown in in the <a class="reference external" href="https://code.google.com/p/shellinabox/wiki/shellinaboxd_man#CONFIGURATION">shellinabox configuration page</a>:</p>
<pre class="literal-block">
&lt;Location /shell&gt;
  ProxyPass  http://localhost:4200/
  Order      allow,deny
  Allow      from all
&lt;/Location&gt;
</pre>
<p>For Apache 2.4 we need to slightly change that as we saw when configuring <tt class="docutils literal">apache2</tt> above. So add these lines to <tt class="docutils literal"><span class="pre">/etc/apache2/vhosts.d/00-default.snap.conf</span></tt>:</p>
<pre class="literal-block">
&lt;Location /shell&gt;
  ProxyPass  http://localhost:4200/
  Require all granted
&lt;/Location&gt;
</pre>
<p>Now test your vhost configuration by running this command:</p>
<pre class="literal-block">
htttpd2 -S
</pre>
<p>If you get the below error, then you need tht http proxy modue to be installed in apache2:</p>
<pre class="literal-block">
Invalid command 'ProxyPass', perhaps misspelled or defined by a module not included in the server configuration
</pre>
<p>In that case, in <tt class="docutils literal">/etc/sysconfig/apache2</tt> find the line starting with <tt class="docutils literal">APACHE_MODULES</tt> and add <tt class="docutils literal">proxy_http_module</tt> to the lis of modules, then perform the <tt class="docutils literal">httpd2 <span class="pre">-S</span> `` check again. Finally, restart ``apache2</tt> with this command:</p>
<pre class="literal-block">
systemctl status apache2.service
</pre>
<div class="note">
<p class="first admonition-title">Note</p>
<p class="last">We need to change <tt class="docutils literal">/etc/sysconfig/apache2</tt> because <tt class="docutils literal">yast</tt> will nuke the vhost configs into IP-based-vhosts. See <a class="reference external" href="https://www.suse.com/documentation/sles11/book_sle_admin/data/sec_apache2_configuration.html">Configuring Apache</a> for more details about manually configuring these files without using <tt class="docutils literal">yast</tt>.</p>
</div>
<p>If apache doesn't restart, then use <tt class="docutils literal">journalctl <span class="pre">-xe</span></tt> fo find out what went wrong. In my case <tt class="docutils literal">proxy_http_module</tt> wasn't installed it's because that's the name in the <tt class="docutils literal">/etc/apache2/sysconfig.d</tt> which is generated by <tt class="docutils literal">/etc/sysconfig/apache2</tt>. In <tt class="docutils literal">/etc/sysconfig/apache2</tt> you need two entries appended to <tt class="docutils literal">APACHE_MODULES</tt>:</p>
<pre class="literal-block">
mod_proxy mod_proxy_http
</pre>
<p>I found out about this by rereading <a class="reference external" href="https://httpd.apache.org/docs/2.4/mod/mod_proxy_http.html">Apache Module mod_proxy_http</a> three times.</p>
<p>If this works, then you should see <tt class="docutils literal">shellinabox</tt> when going to &lt;<a class="reference external" href="http://localhost/shell">http://localhost/shell</a>&gt;&gt; but not yet for &lt;<a class="reference external" href="https://localhost/shell">https://localhost/shell</a>&gt;. For the latter we need to enable <tt class="docutils literal">https</tt> in <tt class="docutils literal">`apache2</tt>.</p>
</div>
<div class="section" id="viewing-the-long-journal">
<h2><a class="toc-backref" href="#id46">Viewing the long journal</a></h2>
<p>Like mentioned before, <tt class="docutils literal">journalctl</tt> views the log journal.</p>
<p>An even handier command is this:</p>
<pre class="literal-block">
journalctl -xe
</pre>
<p>This is shorthand for:</p>
<pre class="literal-block">
journalctl --catalog --pager-end
</pre>
<p>It uses these options:</p>
<pre class="literal-block">
-e --pager-end           Immediately jump to the end in the pager
-x --catalog             Add message explanations where available
</pre>
<p>This is exactly why I like it over log files:</p>
<ul class="simple">
<li>it has explanations that can come in very handy</li>
<li>it directly goes to the pager (on my system <tt class="docutils literal">less</tt>)</li>
</ul>
</div>
<div class="section" id="hardening-apache2-ssl-cyphers">
<h2><a class="toc-backref" href="#id47">Hardening apache2 SSL cyphers</a></h2>
<p>Via <a class="reference external" href="https://hynek.me/articles/hardening-your-web-servers-ssl-ciphers/">Hardening Your Web Server’s SSL Ciphers — Hynek Schlawack</a>:</p>
<p>Edit <tt class="docutils literal"><span class="pre">/etc/apache2/ssl-global.conf</span></tt>, then modify/add these lines:</p>
<pre class="literal-block">
--- a/apache2/ssl-global.conf
+++ b/apache2/ssl-global.conf
&#64;&#64; -77,7 +77,17 &#64;&#64;
        #   SSL Cipher Suite:
        #   List the ciphers that the client is permitted to negotiate.
        #   See the mod_ssl documentation for a complete list.
-       SSLCipherSuite HIGH:MEDIUM:!aNULL:!MD5
+       # SSLCipherSuite HIGH:MEDIUM:!aNULL:!MD5
+        # https://hynek.me/articles/hardening-your-web-servers-ssl-ciphers/
+        SSLCipherSuite ECDH+AESGCM:DH+AESGCM:ECDH+AES256:DH+AES256:ECDH+AES128:DH+AES:ECDH+3DES:DH+3DES:RSA+AESGCM:RSA+AES:RSA+3DES:!aNULL:!MD5:!DSS
+        # normally this is in copies of default-vhost-ssl.conf, but it needs to be default:
+        # https://hynek.me/articles/hardening-your-web-servers-ssl-ciphers/
+        SSLHonorCipherOrder On
+
+        ##  SSL compression:
+        # https://hynek.me/articles/hardening-your-web-servers-ssl-ciphers/
+        # as of Apache2 2.4.4 the default is Off; this is in case you ever run on a lower version.
+        SSLCompression Off

        #   Server Certificate:
        #   Point SSLCertificateFile at a PEM encoded certificate.  If
</pre>
<p>After that, test the config, then restart <tt class="docutils literal">apache2</tt>:</p>
<pre class="literal-block">
revue:~ # apache2ctl -t
Syntax OK
revue:~ # systemctl restart apache2.service
revue:~ # systemctl status apache2.service
● apache2.service - The Apache Webserver
   Loaded: loaded (/usr/lib/systemd/system/apache2.service; enabled; vendor preset: disabled)
   Active: active (running) since Thu 2015-06-11 20:58:12 CEST; 8s ago
 Main PID: 23760 (httpd-prefork)
   Status: &quot;Processing requests...&quot;
   CGroup: /system.slice/apache2.service
           ├─23760 /usr/sbin/httpd-prefork -f /etc/apache2/httpd.conf -DSSL -D SYSTEMD -DFOREGROUND -k start
           ├─23780 /usr/sbin/httpd-prefork -f /etc/apache2/httpd.conf -DSSL -D SYSTEMD -DFOREGROUND -k start
           ├─23781 /usr/sbin/httpd-prefork -f /etc/apache2/httpd.conf -DSSL -D SYSTEMD -DFOREGROUND -k start
           ├─23782 /usr/sbin/httpd-prefork -f /etc/apache2/httpd.conf -DSSL -D SYSTEMD -DFOREGROUND -k start
           ├─23783 /usr/sbin/httpd-prefork -f /etc/apache2/httpd.conf -DSSL -D SYSTEMD -DFOREGROUND -k start
           └─23784 /usr/sbin/httpd-prefork -f /etc/apache2/httpd.conf -DSSL -D SYSTEMD -DFOREGROUND -k start

Jun 11 20:58:11 revue systemd[1]: Starting The Apache Webserver...
Jun 11 20:58:12 revue systemd[1]: Started The Apache Webserver.
revue:~ #
</pre>
<p>Additional information at <a class="reference external" href="https://raymii.org/s/tutorials/Strong_SSL_Security_On_Apache2.html">Secure your Apache Server</a>.</p>
</div>
<div class="section" id="enabling-https-for-apache2">
<h2><a class="toc-backref" href="#id48">Enabling https for apache2</a></h2>
<p>First get and install a certificate.</p>
<p>Then enable <a class="reference external" href="http://httpd.apache.org/docs/2.4/mod/mod_ssl.html">mod_ssl</a>, in <tt class="docutils literal">/etc/sysconfig/apache2</tt> you need one entrie appended to <tt class="docutils literal">APACHE_MODULES</tt>:</p>
<pre class="literal-block">
mod_ssl
</pre>
<div class="note">
<p class="first admonition-title">Note</p>
<p class="last">TODO figure out how to use this together with <cite>mod_proxy</cite> and <cite>mod_proxy_http</cite>; see <cite>how to make Apache proxy http requests to https &lt;http://stackoverflow.com/questions/9977215/how-to-make-apache-proxy-http-requests-to-https&gt;</cite>.</p>
</div>
<div class="section" id="generating-the-private-key-protected-with-a-strong-password">
<h3><a class="toc-backref" href="#id49">Generating the private key protected with a strong password</a></h3>
<div class="sidebar">
<p class="first sidebar-title">strong passwords</p>
<p><a class="reference external" href="https://en.wikipedia.org/wiki/Password_strength#Examples_of_weak_passwords">Avoid weak passwords</a>.</p>
<p>One way of creating a single strong password is by estimating <a class="reference external" href="https://en.wikipedia.org/wiki/Password_strength#Required_Bits_of_Entropy">required bits of entropy</a>, then choosing a <cite>set of characters</cite> and <cite>password length</cite> and generate a <a class="reference external" href="https://en.wikipedia.org/wiki/Password_strength#Random_passwords">random password with at least that length</a>).</p>
<p>Here 16 characters gets you about 80 bits of precision.</p>
<p class="last">But remember that often you need multiple strong passwords, so be sure to read some <a class="reference external" href="https://en.wikipedia.org/wiki/Password_strength#Guidelines_for_strong_passwords">guidelines around strong passwords</a>.</p>
</div>
<p>First a few notes:</p>
<ol class="arabic simple">
<li><a class="reference external" href="http://crypto.stackexchange.com/questions/20253/why-we-cant-implement-aes-512-key-size">There is no AES-512</a>, so the best to use is <a class="reference external" href="https://en.wikipedia.org/wiki/Advanced_Encryption_Standard#Description_of_the_cipher">AES-256</a> (AES wiht a 256-bit key).</li>
<li><a class="reference external" href="https://en.wikipedia.org/wiki/RSA_(cryptosystem)#cite_note-20">RSA keys should be at least 2048 bits long</a>, but 4096 provide even more security (<a class="reference external" href="https://blog.hboeck.de/archives/872-About-the-supposed-factoring-of-a-4096-bit-RSA-key.html">the factoring of a 4096-bit RSA key was a faulty copy</a>).</li>
<li><a class="reference external" href="https://en.wikipedia.org/wiki/Digital_Signature_Algorithm">DSA keys</a> are limited to 1024 bits. Don't use them.</li>
</ol>
<p>The <a class="reference external" href="https://www.openssl.org/docs/apps/genrsa.html">genrsa</a> command of openssl generates RSA keys.</p>
<p>Generate a 4096 bit RSA private key (keep it in a safe place!) encrypted using the 256-bit AES algorithm (be sure to give it a <a class="reference external" href="https://en.wikipedia.org/wiki/Password_strength">strong password</a>!:</p>
<pre class="literal-block">
openssl genrsa -out 4096-bit-rsa-key-encrypted-using-256-bit-aes.private.key -aes256 4096
</pre>
<p>You can also use <a class="reference external" href="https://en.wikipedia.org/wiki/Ssh-keygen">ssh-keygen</a>, but the <a class="reference external" href="https://wiki.osuosl.org/howtos/ssh_key_tutorial.html">default setup is not that secure</a> and <a class="reference external" href="https://github.com/nickchappell/personal-projects-docs/blob/master/services_notes/ssh_notes.md">making it more secure requires openssl</a>.</p>
</div>
<div class="section" id="generate-the-csr-certificate-signing-request">
<h3><a class="toc-backref" href="#id50">Generate the CSR (Certificate Signing Request)</a></h3>
<div class="sidebar">
<p class="first sidebar-title"><cite>tmpfs</cite> on a Mac</p>
<p>On a Mac you have <a class="reference external" href="https://gist.github.com/koshigoe/822455">these nice scripts</a> by <a class="reference external" href="https://gist.github.com/koshigoe">koshigoe</a> to help you creating a <cite>tmpfs</cite>.</p>
<p>They use <a class="reference external" href="https://www.google.com/search?q=hdid">hdid</a>,
<a class="reference external" href="https://www.google.com/search?q=newfs_hfs">newfs_hfs</a>,
<a class="reference external" href="https://www.google.com/search?q=mount">mount</a>,
<a class="reference external" href="https://www.google.com/search?q=umount">umount</a> and
<a class="reference external" href="https://www.google.com/search?q=hdiutil">hdiutil</a>.</p>
<p><a class="reference external" href="https://gist.githubusercontent.com/koshigoe/822455/raw/dd33aeeb0267040743a4f4272cab371e0880770f/mount-ram.sh">mount-ram.sh</a>:</p>
<pre class="literal-block">
#!/bin/sh

# This program has two feature.
#
# 1. Create a disk image on RAM.
# 2. Mount that disk image.
#
# Usage:
#   $0 &lt;dir&gt; &lt;size&gt;
#
#   size:
#     The `size' is a size of disk image (MB).
#
#   dir:
#     The `dir' is a directory, the dir is used to mount the disk image.
#
# See also:
#   - hdid(8)
#

mount_point=${1}
size=${2:-64}

mkdir -p $mount_point
if [ $? -ne 0 ]; then
    echo &quot;The mount point didn't available.&quot; &gt;&amp;2
    exit $?
fi

sector=$(expr $size \* 1024 \* 1024 / 512)
device_name=$(hdid -nomount &quot;ram://${sector}&quot; | awk '{print $1}')
if [ $? -ne 0 ]; then
    echo &quot;Could not create disk image.&quot; &gt;&amp;2
    exit $?
fi

newfs_hfs $device_name &gt; /dev/null
if [ $? -ne 0 ]; then
    echo &quot;Could not format disk image.&quot; &gt;&amp;2
    exit $?
fi

mount -t hfs $device_name $mount_point
if [ $? -ne 0 ]; then
    echo &quot;Could not mount disk image.&quot; &gt;&amp;2
    exit $?
fi
</pre>
<p><a class="reference external" href="https://gist.githubusercontent.com/koshigoe/822455/raw/802073f8f0791ba050180986dfe9091f1bca9abf/umount-ram.sh">umount-ram.sh</a>:</p>
<pre class="last literal-block">
#!/bin/sh

# This program has two features.
#
# 1. Unmount a disk image.
# 2. Detach the disk image from RAM.
#
# Usage:
#   $0 &lt;dir&gt;
#
#   dir:
#     The `dir' is a directory, the dir is mounting a disk image.
#
# See also:
#   - hdid(8)
#

mount_point=$1
if [ ! -d &quot;${mount_point}&quot; ]; then
    echo &quot;The mount point didn't available.&quot; &gt;&amp;2
    exit 1
fi
mount_point=$(cd $mount_point &amp;&amp; pwd)

device_name=$(df &quot;${mount_point}&quot; 2&gt;/dev/null | tail -1 | grep &quot;${mount_point}&quot; | cut -d' ' -f1)
if [ -z &quot;${device_name}&quot; ]; then
    echo &quot;The mount point didn't mount disk image.&quot; &gt;&amp;2
    exit 1
fi

umount &quot;${mount_point}&quot;
if [ $? -ne 0 ]; then
    echo &quot;Could not unmount.&quot; &gt;&amp;2
    exit $?
fi

hdiutil detach -quiet $device_name
</pre>
</div>
<p>Here we will generate a <a class="reference external" href="https://en.wikipedia.org/wiki/Certificate_signing_request">CSR</a> using SHA-256 (which is a <a class="reference external" href="https://en.wikipedia.org/wiki/Secure_Hash_Algorithm">secure hashing</a> function that is part of the <a class="reference external" href="https://en.wikipedia.org/wiki/SHA-2#Comparison_of_SHA_functions">SHA-2</a> family of hashing functions <a class="reference external" href="http://crypto.stackexchange.com/questions/3153/sha-256-vs-any-256-bits-of-sha-512-which-is-more-secure">secure enough for the forseeable future</a>).</p>
<ol class="arabic">
<li><p class="first">Copy your encrypted private key to a temporary directory (important: you <strong>have to clean that directory later on</strong>) preferably in a <a class="reference external" href="https://en.wikipedia.org/wiki/Tmpfs">tmpfs</a> temporary file system.</p>
</li>
<li><p class="first">Decrypt your key (enter your password when openssl asks for it):</p>
<pre class="literal-block">
openssl rsa -in 4096-bit-rsa-key-encrypted-using-256-bit-aes.private.key -out 4096-bit-rsa-key.private.key
</pre>
</li>
<li><p class="first">Create a signing request using the decrypted key for your domain (in this case for the <cite>pluimers.com</cite> domain) with some sensible attributes:</p>
<pre class="literal-block">
# openssl req -new -sha256 -key 4096-bit-rsa-key.private.key -out pluimers.com.csr
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----
Country Name (2 letter code) [AU]:NL
State or Province Name (full name) [Some-State]:Noord-Holland
Locality Name (eg, city) []:Amsterdam
Organization Name (eg, company) [Internet Widgits Pty Ltd]:Pluimers Software Ontwikkeling B.V.
Organizational Unit Name (eg, section) []:
Common Name (e.g. server FQDN or YOUR name) []:pluimers.com
Email Address []:webmaster&#64;pluimers.com

Please enter the following 'extra' attributes
to be sent with your certificate request
A challenge password []:
An optional company name []:
# openssl req -noout -text -in pluimers.com.csr
    Data:
        Version: 0 (0x0)
        Subject: C=NL, ST=Noord-Holland, L=Amsterdam, O=Pluimers Software Ontwikkeling B.V., CN=pluimers.com/emailAddress=webmaster&#64;pluimers.com
        Subject Public Key Info:
</pre>
</li>
<li><p class="first">Follow the <cite>StartSSL</cite> steps at <a class="reference external" href="https://konklone.com/post/switch-to-https-now-for-free#generating-the-certificate">Generating the Certificate</a>.</p>
<blockquote>
<ul>
<li><p class="first">note you can only have 1 specific subdomain when your StartSSL identity is class 1.</p>
</li>
<li><p class="first">the upload and processing of the CRS takes a few minutes</p>
</li>
<li><p class="first">the generation of the certificate can take like 5 minutes</p>
</li>
<li><p class="first">copy the resulting certificate to <tt class="docutils literal">pluimers.com.crt</tt></p>
</li>
<li><dl class="first docutils">
<dt>on your OpenSuSE server, save these files:</dt>
<dd><ul class="first last simple">
<li>Certificate: <tt class="docutils literal">/etc/apache2/ssl.crt/pluimers.com.crt</tt></li>
<li>Decrypted private key: <tt class="docutils literal">/etc/apache2/ssl.key/pluimers.com.key</tt></li>
</ul>
</dd>
</dl>
</li>
</ul>
</blockquote>
</li>
<li><p class="first">Fix this error by changing <tt class="docutils literal"><span class="pre">/etc/apache2/vhosts.d/pluimers.com-ssl.conf</span></tt> from <tt class="docutils literal">ServerName revue</tt> into <tt class="docutils literal">ServerName www.pluimers.com</tt>:</p>
<pre class="literal-block">
[Sun Jun 28 16:43:40.342067 2015] [ssl:debug] [pid 5251] ssl_util_ssl.c(356): AH02412: [revue:443] Cert does not match for name 'revue' [subject: emailAddress=webmaster&#64;pluimers.com,CN=www.pluimers.com,C=NL / issuer: CN=StartCom Class 1 Primary Intermediate Server CA,OU=Secure Digital Certificate Signing,O=StartCom Ltd.,C=IL / serial: 05D759EC0CF620 / notbefore: Jun 14 08:24:00 2015 GMT / notafter: Jun 14 14:46:36 2016 GMT]
</pre>
</li>
</ol>
<p>&lt;<a class="reference external" href="http://ndg-security.ceda.ac.uk/wiki/ndg_security/Apache2/SUSE#SSL">http://ndg-security.ceda.ac.uk/wiki/ndg_security/Apache2/SUSE#SSL</a>&gt;</p>
<p>SSLLabs test will most likely give this downgrade:</p>
<blockquote>
This server's certificate chain is incomplete. Grade capped to B.</blockquote>
<p>So make sure you chain your certificates when using startSSL:</p>
<pre class="literal-block">
pushd /etc/apache2/ssl.crt
wget -m -np https://www.startssl.com/certs/class1/sha2/pem/sub.class1.server.sha2.ca.pem
cat pluimers.com.crt www.startssl.com/certs/class1/sha2/pem/sub.class1.server.sha2.ca.pem &gt; pluimers.com-chain.crt
popd
</pre>
<p>Now ensure these two lines in <tt class="docutils literal"><span class="pre">/etc/apache2/vhosts.d/pluimers.com-ssl.conf</span></tt> are as follows:</p>
<pre class="literal-block">
#SSLCertificateFile /etc/apache2/ssl.crt/pluimers.com.crt
SSLCertificateKeyFile /etc/apache2/ssl.key/pluimers.com.key
SSLCertificateChainFile /etc/apache2/ssl.crt/pluimers.com-chain.crt
</pre>
<p>Finally, restart the apache2 service:</p>
<pre class="literal-block">
rcapache2 stop
rcapache2 start
</pre>
<p>If it fails, then look through errors in <tt class="docutils literal"><span class="pre">/var/log/apache2/pluimers.com-ssl-error_log</span></tt>, as <tt class="docutils literal">journalctl <span class="pre">-xe</span></tt> will not show details.</p>
<div class="sidebar">
<p class="first sidebar-title">Important apache restart note</p>
<p><tt class="docutils literal">rcapache2 restart</tt> will not fully unload the apache configuration. Use this in stead:</p>
<pre class="literal-block">
rcapache2 stop
rcapache2 start
</pre>
<p>Without it, you will get spurious errors (like <a class="reference external" href="https://www.pluimers.com">https://www.pluimers.com</a> re-using part of the virtual directory configuration for <a class="reference external" href="http://www.pluimers.com">http://www.pluimers.com</a> thereby generating spurious 403-errors) in log files like the <tt class="docutils literal">403 1032</tt> and <tt class="docutils literal">403 1018</tt> error codes and <tt class="docutils literal">authorization result of &lt;RequireAny&gt;: denied</tt> in below logs.</p>
<p>BTW:</p>
<blockquote>
Note the differences in time-stamp logging. Don't you hate that? What happened to ISO-8601?</blockquote>
<p>pluimers.com-ssl_request_log:</p>
<pre class="literal-block">
[29/Jun/2015:20:16:40 +0200] 80.100.143.119 TLSv1.2 ECDHE-RSA-AES128-GCM-SHA256 &quot;GET / HTTP/1.1&quot; 1032 &quot;-&quot; &quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/43.0.2357.130 Safari/537.36&quot;
[29/Jun/2015:20:16:40 +0200] 80.100.143.119 TLSv1.2 ECDHE-RSA-AES128-GCM-SHA256 &quot;GET /favicon.ico HTTP/1.1&quot; 1018 &quot;https://www.pluimers.com/&quot; &quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/43.0.2357.130 Safari/537.36&quot;
</pre>
<p>pluimers.com-access_log:</p>
<pre class="literal-block">
revue 80.100.143.119 - - [29/Jun/2015:20:16:40 +0200] &quot;GET / HTTP/1.1&quot; 403 1032 &quot;-&quot; &quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/43.0.2357.130 Safari/537.36&quot;
revue 80.100.143.119 - - [29/Jun/2015:20:16:40 +0200] &quot;GET /favicon.ico HTTP/1.1&quot; 403 1018 &quot;https://www.pluimers.com/&quot; &quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/43.0.2357.130 Safari/537.36&quot;
</pre>
<p>pluimers.com-ssl-error_log:</p>
<pre class="last literal-block">
[Mon Jun 29 20:16:40.266336 2015] [ssl:info] [pid 5588] [client 80.100.143.119:63297] AH01964: Connection to child 5 established (server revue:443)
[Mon Jun 29 20:16:40.267090 2015] [ssl:debug] [pid 5588] ssl_engine_kernel.c(1908): [client 80.100.143.119:63297] AH02043: SSL virtual host for servername www.pluimers.com found
[Mon Jun 29 20:16:40.267832 2015] [ssl:info] [pid 5589] [client 80.100.143.119:63298] AH01964: Connection to child 6 established (server revue:443)
[Mon Jun 29 20:16:40.268728 2015] [ssl:debug] [pid 5589] ssl_engine_kernel.c(1908): [client 80.100.143.119:63298] AH02043: SSL virtual host for servername www.pluimers.com found
[Mon Jun 29 20:16:40.298407 2015] [ssl:debug] [pid 5588] ssl_engine_kernel.c(1841): [client 80.100.143.119:63297] AH02041: Protocol: TLSv1.2, Cipher: ECDHE-RSA-AES128-GCM-SHA256 (128/128 bits)
[Mon Jun 29 20:16:40.303995 2015] [ssl:debug] [pid 5589] ssl_engine_kernel.c(1841): [client 80.100.143.119:63298] AH02041: Protocol: TLSv1.2, Cipher: ECDHE-RSA-AES128-GCM-SHA256 (128/128 bits)
[Mon Jun 29 20:16:40.646809 2015] [ssl:debug] [pid 5588] ssl_engine_kernel.c(243): [client 80.100.143.119:63297] AH02034: Initial (No.1) HTTPS request received for child 5 (server revue:443)
[Mon Jun 29 20:16:40.647091 2015] [authz_core:debug] [pid 5588] mod_authz_core.c(809): [client 80.100.143.119:63297] AH01626: authorization result of Require all denied: denied
[Mon Jun 29 20:16:40.647104 2015] [authz_core:debug] [pid 5588] mod_authz_core.c(809): [client 80.100.143.119:63297] AH01626: authorization result of &lt;RequireAny&gt;: denied
[Mon Jun 29 20:16:40.647112 2015] [authz_core:error] [pid 5588] [client 80.100.143.119:63297] AH01630: client denied by server configuration: /srv/www/vhosts/pluimers.com/
[Mon Jun 29 20:16:40.647239 2015] [authz_core:debug] [pid 5588] mod_authz_core.c(809): [client 80.100.143.119:63297] AH01626: authorization result of Require all granted: granted
[Mon Jun 29 20:16:40.647250 2015] [authz_core:debug] [pid 5588] mod_authz_core.c(809): [client 80.100.143.119:63297] AH01626: authorization result of &lt;RequireAny&gt;: granted
[Mon Jun 29 20:16:40.792584 2015] [ssl:debug] [pid 5588] ssl_engine_kernel.c(243): [client 80.100.143.119:63297] AH02034: Subsequent (No.2) HTTPS request received for child 5 (server revue:443), referer: https://www.pluimers.com/
[Mon Jun 29 20:16:40.792637 2015] [authz_core:debug] [pid 5588] mod_authz_core.c(809): [client 80.100.143.119:63297] AH01626: authorization result of Require all denied: denied, referer: https://www.pluimers.com/
[Mon Jun 29 20:16:40.792667 2015] [authz_core:debug] [pid 5588] mod_authz_core.c(809): [client 80.100.143.119:63297] AH01626: authorization result of &lt;RequireAny&gt;: denied, referer: https://www.pluimers.com/
[Mon Jun 29 20:16:40.792676 2015] [authz_core:error] [pid 5588] [client 80.100.143.119:63297] AH01630: client denied by server configuration: /srv/www/vhosts/pluimers.com/favicon.ico, referer: https://www.pluimers.com/
[Mon Jun 29 20:16:40.792711 2015] [authz_core:debug] [pid 5588] mod_authz_core.c(809): [client 80.100.143.119:63297] AH01626: authorization result of Require all granted: granted, referer: https://www.pluimers.com/
[Mon Jun 29 20:16:40.792722 2015] [authz_core:debug] [pid 5588] mod_authz_core.c(809): [client 80.100.143.119:63297] AH01626: authorization result of &lt;RequireAny&gt;: granted, referer: https://www.pluimers.com/
[Mon Jun 29 20:16:50.646230 2015] [ssl:info] [pid 5589] (70014)End of file found: [client 80.100.143.119:63298] AH01991: SSL input filter read failed.
[Mon Jun 29 20:16:50.646659 2015] [ssl:debug] [pid 5589] ssl_engine_io.c(1003): [client 80.100.143.119:63298] AH02001: Connection closed to child 6 with standard shutdown (server revue:443)
[Mon Jun 29 20:16:55.808702 2015] [ssl:info] [pid 5588] (70007)The timeout specified has expired: [client 80.100.143.119:63297] AH01991: SSL input filter read failed.
[Mon Jun 29 20:16:55.808989 2015] [ssl:debug] [pid 5588] ssl_engine_io.c(1003): [client 80.100.143.119:63297] AH02001: Connection closed to child 5 with standard shutdown (server revue:443)
</pre>
</div>
<hr class="docutils" />
<ol class="arabic simple" start="0">
<li>Remove the temporary directory (preferably, delete the whole <tt class="docutils literal">tmpfs</tt> volume it is on).</li>
</ol>
<p>&lt;<a class="reference external" href="https://blog.websenat.de/2014/05/03/sysadmin-openssl-befehle-und-tipps/">https://blog.websenat.de/2014/05/03/sysadmin-openssl-befehle-und-tipps/</a>&gt;</p>
<p>&lt;<a class="reference external" href="https://twitter.com/konklone/status/493748256933810178">https://twitter.com/konklone/status/493748256933810178</a>&gt;</p>
<p>&lt;<a class="reference external" href="https://konklone.com/post/switch-to-https-now-for-free#generating-the-certificate">https://konklone.com/post/switch-to-https-now-for-free#generating-the-certificate</a>&gt;</p>
<p>&lt;<a class="reference external" href="https://gist.github.com/konklone/98f48a90bfd9cfd076dc">https://gist.github.com/konklone/98f48a90bfd9cfd076dc</a>&gt;
Full log:</p>
<pre class="literal-block">
# openssl req -new -sha256 -key 4096-bit-rsa-key.private.key -out pluimers.com.csr
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----
Country Name (2 letter code) [AU]:NL
State or Province Name (full name) [Some-State]:Noord-Holland
Locality Name (eg, city) []:Amsterdam
Organization Name (eg, company) [Internet Widgits Pty Ltd]:Pluimers Software Ontwikkeling B.V.
Organizational Unit Name (eg, section) []:
Common Name (e.g. server FQDN or YOUR name) []:pluimers.com
Email Address []:webmaster&#64;pluimers.com

Please enter the following 'extra' attributes
to be sent with your certificate request
A challenge password []:
An optional company name []:
</pre>
</div>
<div class="section" id="id15">
<h3><a class="toc-backref" href="#id51">Notes</a></h3>
<p>&lt;<a class="reference external" href="https://www.suse.com/documentation/sles11/book_sle_admin/data/sec_apache2_ssl.html#sec_apache2_ssl_configuration_name-based">https://www.suse.com/documentation/sles11/book_sle_admin/data/sec_apache2_ssl.html#sec_apache2_ssl_configuration_name-based</a>&gt;</p>
<p>&lt;<a class="reference external" href="https://192.168.71.62/shell">https://192.168.71.62/shell</a>&gt;</p>
<p>fails: &lt;<a class="reference external" href="https://revue.pluimers.com/shell">https://revue.pluimers.com/shell</a>&gt;</p>
<p>&lt;<a class="reference external" href="https://80.100.143.119/shell">https://80.100.143.119/shell</a>&gt;</p>
<p>&lt;<a class="reference external" href="https://hynek.me/articles/hardening-your-web-servers-ssl-ciphers/">https://hynek.me/articles/hardening-your-web-servers-ssl-ciphers/</a>&gt;</p>
<p>&lt;<a class="reference external" href="http://httpd.apache.org/docs/2.4/ssl/ssl_howto.html">http://httpd.apache.org/docs/2.4/ssl/ssl_howto.html</a>&gt;</p>
<p>&lt;<a class="reference external" href="https://raymii.org/s/tutorials/Strong_SSL_Security_On_Apache2.html">https://raymii.org/s/tutorials/Strong_SSL_Security_On_Apache2.html</a>&gt;</p>
<p>&lt;<a class="reference external" href="http://www.techytalk.info/remote-cli-access-to-ubuntu-pc-using-web-browser-through-authenticated-https/comment-page-1/">http://www.techytalk.info/remote-cli-access-to-ubuntu-pc-using-web-browser-through-authenticated-https/comment-page-1/</a>&gt;</p>
<p>&lt;<a class="reference external" href="https://konklone.com/post/switch-to-https-now-for-free">https://konklone.com/post/switch-to-https-now-for-free</a>&gt;</p>
<p>&lt;<a class="reference external" href="https://letsencrypt.org">https://letsencrypt.org</a>&gt;</p>
<p>&lt;<a class="reference external" href="http://www.unixmen.com/create-ssl-cetificates-in-opensuse-12-3/">http://www.unixmen.com/create-ssl-cetificates-in-opensuse-12-3/</a>&gt;</p>
<p>&lt;<a class="reference external" href="https://en.opensuse.org/SDB:Apache_installation">https://en.opensuse.org/SDB:Apache_installation</a>&gt;</p>
<p>&lt;<a class="reference external" href="https://www.suse.com/documentation/sles11/book_sle_admin/data/sec_apache2_ssl.html">https://www.suse.com/documentation/sles11/book_sle_admin/data/sec_apache2_ssl.html</a>&gt;</p>
<p>&lt;<a class="reference external" href="http://stackoverflow.com/questions/24888407/setting-up-apache-w-ssl-using-opensuse-yast">http://stackoverflow.com/questions/24888407/setting-up-apache-w-ssl-using-opensuse-yast</a>&gt;</p>
<p>&lt;<a class="reference external" href="http://blog.remibergsma.com/2013/03/15/always-available-linux-terminal-shell-in-a-box-on-raspberry-pi/">http://blog.remibergsma.com/2013/03/15/always-available-linux-terminal-shell-in-a-box-on-raspberry-pi/</a>&gt;</p>
<div class="note">
<p class="first admonition-title">Note</p>
<p class="last">test with testssl.sh</p>
</div>
<p>&lt;<a class="reference external" href="https://weakdh.org/">https://weakdh.org/</a>&gt;</p>
<p>Ligt complexer; het SHA-256 verhaal gaat over de certificate signature; niet over de versleuteling van de verbinding zelf. Zie ook: <a class="reference external" href="http://googleonlinesecuri...lly-sunsetting-sha-1.html">http://googleonlinesecuri...lly-sunsetting-sha-1.html</a></p>
<p>Om 'modern cryptography / groene balk / geen warnings / errors ' te krijgen in de nieuwste Chrome, IE en Firefox moet je dus certs hebben die op RSA 2048 with SHA-256 of langer gebaseerd zijn of langer, dus geen RSA-512/1024 of SHA-1 of MD5 meer in de certificaat-chain (op de root CA na) en tevens dient er moderne, veilige ciphers met Forward Secrecy gebruikt te worden; waarbij AES-GCM de meest gangbare is. Ook b.v. AES-256-CBC is dus niet goed, omdat CBC een niet-authenticated blockcipher is en GCM wel authenticated is (en stukken sneller !).</p>
<p>Voor meer info zie b.v: <a class="reference external" href="http://googleonlinesecuri...lly-sunsetting-sha-1.html">http://googleonlinesecuri...lly-sunsetting-sha-1.html</a> Of de SslLabs blog: <a class="reference external" href="https://community.qualys.com/blogs/securitylabs">https://community.qualys.com/blogs/securitylabs</a></p>
</div>
</div>
<div class="section" id="zypper-updating">
<h2><a class="toc-backref" href="#id52">Zypper updating</a></h2>
<p>The only way to update Tumbleweed is through the distribution update:</p>
<pre class="literal-block">
zypper dup
</pre>
<p>If it doesn't update anything: find when more repostories are added:</p>
<p>&lt;<a class="reference external" href="https://forums.opensuse.org/showthread.php/506273-Distribution-Upgrade-on-Tumbleweed-Gnome-(sudo-zypper-dup)">https://forums.opensuse.org/showthread.php/506273-Distribution-Upgrade-on-Tumbleweed-Gnome-(sudo-zypper-dup)</a>&gt;</p>
<p>&lt;<a class="reference external" href="http://linux.derkeiler.com/Mailing-Lists/SuSE/2014-11/msg01554.html">http://linux.derkeiler.com/Mailing-Lists/SuSE/2014-11/msg01554.html</a>&gt;</p>
<p>Show all the details of your configured repositories:</p>
<pre class="literal-block">
zypper repos --details
</pre>
</div>
<div class="section" id="mariadb-dependency">
<h2><a class="toc-backref" href="#id53">mariadb dependency</a></h2>
<p>20150706 - somehow mariadb got installed (MySQL):</p>
<pre class="literal-block">
(Use the Enter or Space key to scroll the text by lines or pages.)

Message from package mariadb:


You just installed MySQL server for the first time.

You can start it using:
 rcmysql start

During first start empty database will be created for your automatically.

PLEASE REMEMBER TO SET A PASSWORD FOR THE MariaDB root USER !
To do so, start the server, then issue the following commands:

'/usr/bin/mysqladmin' -u root password 'new-password'
'/usr/bin/mysqladmin' -u root -h misibook password 'new-password'

Alternatively you can run:
'/usr/bin/mysql_secure_installation'

which will also give you the option of removing the test
databases and anonymous user created by default. This is
strongly recommended for production servers.


-----------------------------------------------------------------------------


(Press 'q' to exit the pager.)
/var/tmp/TmpFile.A0c0jv lines 1-30/30 (END)
</pre>
<hr class="docutils" />
<table class="docutils footnote" frame="void" id="opensuse-footnote" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>I keep using the old <a class="reference external" href="https://en.wikipedia.org/wiki/SUSE">SuSE</a> writing, I'm an old fart.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="tumbleweed-footnote" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td><a class="reference external" href="https://en.opensuse.org/Portal:Tumbleweed">Tumbleweed</a> is the rolling release of OpenSuSE.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="revue-footnote" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[3]</a></td><td>See <a class="reference external" href="https://en.wikipedia.org/wiki/Snip_en_Snap">Snip en Snap revue</a>.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="headless-footnote" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[4]</a></td><td><a class="reference external" href="https://en.wikipedia.org/wiki/Headless_software">Headless</a> as in no GUI, not as in <a class="reference external" href="https://en.wikipedia.org/wiki/Embedded_system">Embedded System</a>. So there is a text <a class="reference external" href="https://en.wikipedia.org/wiki/System_console">console</a>, and remote <a class="reference external" href="https://en.wikipedia.org/wiki/Secure_Shell">ssh</a>.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="patterns-opensuse-minimal-base-conflicts-footnote" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id9">[5]</a></td><td>The <a class="reference external" href="https://www.google.com/search?q=patterns-openSUSE-minimal_base-conflicts">patterns-openSUSE-minimal_base-conflicts</a> is there to <a class="reference external" href="http://unix.stackexchange.com/questions/144438/missing-broken-dependancies-on-opensuse-normal/144583#144583">prevent recommended packages to blow up a minimal installation</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="removeconflicts-footnote" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id10">[6]</a></td><td>The <a class="reference external" href="http://unix.stackexchange.com/questions/73427/cant-install-python-because-of-zypper-conflict">actual conflicts package</a> contains the version number of the distribution you use.</td></tr>
</tbody>
</table>
</div>
</div>
</div>
</body>
</html>
